# Database Schema Documentation

**Generated by Schema Tool v2**

---

## Table of Contents

1. [Coverage Summary](#coverage-summary)
2. [Entity Definitions](#entity-definitions)
   - [CreditTransaction](#credittransaction)
   - [Purchase](#purchase)
   - [User](#user)
   - [Discount](#discount)
   - [Category](#category)
   - [Background](#background)
   - [Tier](#tier)
   - [Milestone](#milestone)
   - [GalleryItem](#galleryitem)
   - [Payment](#payment)
   - [Filter](#filter)
   - [Video](#video)
   - [Model](#model)
   - [Export](#export)
   - [Style](#style)
   - [Effect](#effect)
   - [Package](#package)
   - [Reward](#reward)
   - [Tag](#tag)
   - [Subscription](#subscription)
   - [Overlay](#overlay)
   - [Watermark](#watermark)
3. [Eloquent Relationships](#eloquent-relationships)
4. [Indexes Strategy](#indexes-strategy)
5. [Retrieval Query Examples](#retrieval-query-examples)
6. [Schema Remarks](#schema-remarks)

---

## Coverage Summary

| Entity | Table | Coverage Type | Plugin/Package | Migration Action |
|--------|-------|---------------|----------------|------------------|
| CreditTransaction | `credit_transactions` | CUSTOM | `N/A` | **create** |
| Purchase | `purchases` | CUSTOM | `N/A` | **create** |
| User | `users` | CUSTOM | `N/A` | **create** |
| Discount | `discounts` | CUSTOM | `N/A` | **create** |
| Category | `categories` | CUSTOM | `N/A` | **create** |
| Background | `backgrounds` | CUSTOM | `N/A` | **create** |
| Tier | `tiers` | CUSTOM | `N/A` | **create** |
| Milestone | `milestones` | CUSTOM | `N/A` | **create** |
| GalleryItem | `gallery_items` | CUSTOM | `N/A` | **create** |
| Payment | `payments` | CUSTOM | `N/A` | **create** |
| Filter | `filters` | CUSTOM | `N/A` | **create** |
| Video | `videos` | CUSTOM | `N/A` | **create** |
| Model | `models` | CUSTOM | `N/A` | **create** |
| Export | `exports` | CUSTOM | `N/A` | **create** |
| Style | `styles` | CUSTOM | `N/A` | **create** |
| Effect | `effects` | CUSTOM | `N/A` | **create** |
| Package | `packages` | CUSTOM | `N/A` | **create** |
| Reward | `rewards` | CUSTOM | `N/A` | **create** |
| Tag | `tags` | CUSTOM | `N/A` | **create** |
| Subscription | `subscriptions` | CUSTOM | `N/A` | **create** |
| Overlay | `overlays` | CUSTOM | `N/A` | **create** |
| Watermark | `watermarks` | CUSTOM | `N/A` | **create** |

### Coverage Types

- **CORE**: Standard Laravel application entity
- **PLUGIN_FULL**: Fully managed by Laravel plugin
- **PLUGIN_AUGMENTED**: Plugin entity with custom fields
- **THIRD_PARTY**: External service integration

---

## Entity Definitions

### CreditTransaction

> Records transactions of loyalty credits/points for users, such as earning from activities or spending on purchases.

**Table:** `credit_transactions`  
**Scope:** TENANT  
**Storage Class:** EVENT_LOG  
**Lifecycle:** PERSISTENT  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the credit transaction. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | The user who this transaction belongs to. |
| `type` | STRING | string(50) | NOT NULL, INDEXED | Type of transaction (e.g., EARNED_PROCESSING, SPENT_PURCHASE, PURCHASED_PACK, ADMIN_ADJUSTMENT). |
| `amount` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The amount of credits transacted. Can be positive (earned) or negative (spent). |
| `description` | TEXT | text | - | A human-readable description of the transaction. |
| `related_id` | BIGINT | unsigned_big_integer | INDEXED | Polymorphic relation ID to the source of the transaction (e.g., Video, Purchase). |
| `related_type` | STRING | string | INDEXED | Polymorphic relation type to the source of the transaction (e.g., App\Models\Video, App\Models\Purchase). |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Indexes

- **credit_transactions_related_poly_index**: `related_id, related_type`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`
- **morphTo()**: Polymorphic (morphTo/morphMany) ‚Üí `RelatedItem`

---

### Purchase

> Stores records of all user purchases, such as one-time exports, credit packs, or subscriptions.

**Table:** `purchases`  
**Scope:** TENANT  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the purchase. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | The user who made the purchase. |
| `purchasable_id` | BIGINT | unsigned_big_integer | NOT NULL, INDEXED | Polymorphic relation ID for the item being purchased (e.g., Package, Subscription). |
| `purchasable_type` | STRING | string | NOT NULL, INDEXED | Polymorphic relation type for the item being purchased (e.g., App\Models\Package). |
| `discount_id` | BIGINT | foreign_id | **FK** ‚Üí `discounts.id`, INDEXED | The discount applied to this purchase, if any. |
| `total_amount` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The final amount paid after any discounts. |
| `currency` | STRING | string(3) | NOT NULL, DEFAULT `USD` | The currency of the transaction (e.g., USD). |
| `status` | STRING | string(50) | NOT NULL, DEFAULT `PENDING`, INDEXED | The status of the purchase (e.g., PENDING, COMPLETED, FAILED, REFUNDED). |
| `processed_at` | TIMESTAMP | timestamp | - | Timestamp when the payment was successfully processed. |
| `provider_transaction_id` | STRING | string | INDEXED | The transaction ID from the external payment provider (e.g., Stripe). |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Indexes

- **purchases_purchasable_poly_index**: `purchasable_id, purchasable_type`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`
- **morphTo()**: Polymorphic (morphTo/morphMany) ‚Üí `PurchasableItem`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Discount`

---

### User

> Stores user account information, authentication details, and links to their assets and subscriptions.

**Table:** `users`  
**Scope:** TENANT  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the user. |
| `name` | STRING | string | NOT NULL, üîí PII, üîê ENCRYPTED | User's full name. |
| `email` | STRING | string | UNIQUE, NOT NULL, INDEXED, üîí PII, üîê ENCRYPTED | User's unique email address, used for login and communication. |
| `email_verified_at` | TIMESTAMP | timestamp | UNIQUE | Timestamp when the user verified their email address. |
| `password` | STRING | string | NOT NULL | User's hashed password. |
| `remember_token` | STRING | remember_token | - | Token for the 'remember me' functionality. |
| `credit_balance` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | Current balance of loyalty/discount credits. |
| `subscription_id` | BIGINT | foreign_id | **FK** ‚Üí `subscriptions.id`, INDEXED | The user's active subscription, if any. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Eloquent Relationships

- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `CreditTransaction`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Purchase`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Milestone`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Subscription`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Reward`

---

### Discount

> Stores discount codes and promotions that can be applied to purchases.

**Table:** `discounts`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the discount. |
| `code` | STRING | string(100) | UNIQUE, NOT NULL, INDEXED | The unique code for the discount that users can enter. |
| `description` | TEXT | text | - | A description of the discount for internal reference. |
| `type` | STRING | string(50) | NOT NULL, DEFAULT `PERCENTAGE` | The type of discount (e.g., PERCENTAGE, FIXED_AMOUNT). |
| `value` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The value of the discount (e.g., 10.00 for 10% or $10.00). |
| `max_uses` | INTEGER | integer | - | The maximum number of times this discount can be used in total. Null for unlimited. |
| `uses` | INTEGER | integer | NOT NULL, DEFAULT `0` | The number of times this discount has been used. |
| `starts_at` | TIMESTAMP | timestamp | - | The timestamp when the discount becomes active. |
| `expires_at` | TIMESTAMP | timestamp | - | The timestamp when the discount expires. |
| `is_active` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | Whether the discount is currently active. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Eloquent Relationships

- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Purchase`

---

### Category

> Stores categories for organizing AI effects, making them easier for users to discover.

**Table:** `categories`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the category. |
| `parent_id` | BIGINT | foreign_id | **FK** ‚Üí `categories.id`, INDEXED | The parent category for creating hierarchical structures. |
| `name` | STRING | string | NOT NULL, INDEXED | The display name of the category. |
| `slug` | STRING | string | UNIQUE, NOT NULL, INDEXED | A URL-friendly version of the category name. |
| `description` | TEXT | text | - | A description of the category's content. |
| `is_visible` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | Controls whether the category is visible to users. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Category`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Category`

---

### Background

> Stores background images or videos that can be applied as AI effects.

**Table:** `backgrounds`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the background. |
| `name` | STRING | string | UNIQUE, NOT NULL | The display name of the background. |
| `image_url` | TEXT | text | NOT NULL | URL to the background image file, likely stored in cloud storage (e.g., S3). |
| `is_default` | BOOLEAN | boolean | NOT NULL, DEFAULT `false`, INDEXED | Indicates if this is a default background option available to all users. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

---

### Tier

> Defines subscription tiers or user levels, such as Free, Pro, and Business.

**Table:** `tiers`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the tier. |
| `name` | STRING | string | UNIQUE, NOT NULL | The unique name of the subscription tier (e.g., 'Free', 'Pro'). |
| `description` | TEXT | text | - | A brief description of the tier's benefits. |
| `price_monthly` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The monthly price for this tier. |
| `price_yearly` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The yearly price for this tier. |
| `features` | JSON | json | - | A JSON array of features included in this tier. |
| `is_active` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | A flag to enable or disable the tier from being offered to new users. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Eloquent Relationships

- **morphMany()**: Polymorphic (morphTo/morphMany) ‚Üí `Purchase`

---

### Milestone

> Tracks gamified user achievements and milestones, such as processing a certain number of videos.

**Table:** `milestones`  
**Scope:** USER_PRIVATE  
**Storage Class:** COMPUTED_CACHE  
**Lifecycle:** PERSISTENT  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the milestone. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | The user who achieved this milestone. |
| `name` | STRING | string | NOT NULL | The name of the milestone (e.g., 'First Video Processed'). |
| `description` | TEXT | text | - | A description of what the milestone entails. |
| `target_count` | INTEGER | integer | NOT NULL, DEFAULT `1` | The target number of actions required to achieve the milestone. |
| `achieved_at` | TIMESTAMP | timestamp | - | Timestamp when the user achieved this milestone. |
| `reward_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `rewards.id`, INDEXED | The reward (e.g., discount) granted for achieving this milestone. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Indexes

- **milestones_user_id_name_unique** (UNIQUE): `user_id, name`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Reward`

---

### GalleryItem

> Represents a user's video that has been published to the public 'Explore' gallery.

**Table:** `gallery_items`  
**Scope:** USER_SHARED  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** SOFT_DELETE  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the gallery item. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | The user who created and published this item. |
| `video_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `videos.id`, NOT NULL, INDEXED | The processed video being shared in the gallery. |
| `effect_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `effects.id`, NOT NULL, INDEXED | The AI effect used in the video, for filtering and discovery. |
| `title` | STRING | string | NOT NULL | User-provided title for the gallery item. |
| `description` | TEXT | text | - | User-provided description for the gallery item. |
| `is_public` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | Controls the visibility of the item in the public gallery. |
| `view_count` | BIGINT | unsigned_big_integer | NOT NULL, DEFAULT `0`, INDEXED | A counter for the number of times the gallery item has been viewed. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Video`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Effect`

---

### Payment

> Records all financial transactions, such as subscription payments or one-time purchases.

**Table:** `payments`  
**Scope:** USER_PRIVATE  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the payment. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | The user who made the payment. |
| `purchase_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `purchases.id`, NOT NULL, INDEXED | The purchase record this payment is associated with. |
| `amount` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0`, üîê ENCRYPTED | The monetary amount of the transaction. |
| `currency` | STRING | string(3) | NOT NULL, DEFAULT `USD` | The ISO 4217 currency code (e.g., USD). |
| `status` | STRING | string(50) | NOT NULL, DEFAULT `pending`, INDEXED | The status of the payment (e.g., pending, completed, failed, refunded). |
| `provider` | STRING | string(50) | NOT NULL, INDEXED | The payment provider used for the transaction (e.g., 'stripe', 'paddle'). |
| `provider_transaction_id` | STRING | string | UNIQUE, NOT NULL, INDEXED | The unique transaction identifier from the payment provider. |
| `processed_at` | TIMESTAMP | timestamp | - | Timestamp indicating when the payment was successfully processed. |
| `metadata` | JSON | json | üîê ENCRYPTED | Stores any additional metadata from the payment provider. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Purchase`

---

### Filter

> Manages AI effects or visual filters that can be applied to videos. These are the core 'effects' users select from the library.

**Table:** `filters`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the filter. |
| `category_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `categories.id`, INDEXED | Foreign key linking to the effect category for organization. |
| `name` | STRING | string | UNIQUE, NOT NULL | The public-facing name of the filter/effect (e.g., 'Snowfall Overlay'). |
| `description` | TEXT | text | - | A user-friendly description of what the effect does and its suggested use case. |
| `settings_json` | JSON | json | - | Stores configuration parameters for the AI model, such as default intensity, color palettes, or other customizable options. |
| `preview_video_url` | STRING | string(2048) | - | URL to a sample video that demonstrates the effect in action. |
| `is_premium` | BOOLEAN | boolean | NOT NULL, DEFAULT `false`, INDEXED | Flag indicating if this effect requires a premium subscription to use. |
| `is_active` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | A soft-toggle to enable or disable the filter's availability to users without deleting it. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **filters_category_id_index**: `category_id`
- **filters_is_premium_is_active_index**: `is_premium, is_active`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Category`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Model`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Export`

---

### Video

> Represents the original, user-uploaded video files. This is the source material before any effects are applied.

**Table:** `videos`  
**Scope:** TENANT  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the video record. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | Foreign key linking to the user who uploaded the video. |
| `uuid` | UUID | uuid | UNIQUE, NOT NULL, INDEXED | A public-facing, unique identifier for the video, used in URLs and APIs. |
| `original_filename` | STRING | string | NOT NULL, üîí PII, üîê ENCRYPTED | The original filename of the video as uploaded by the user. |
| `storage_path` | STRING | string(1024) | NOT NULL | The path to the video file in the cloud storage provider (e.g., S3 bucket path). |
| `mime_type` | STRING | string(128) | - | The MIME type of the uploaded video file (e.g., 'video/mp4'). |
| `file_size` | BIGINT | unsigned_big_integer | NOT NULL, DEFAULT `0` | The size of the video file in bytes. |
| `duration` | DECIMAL | decimal(8,2) | - | The duration of the video in seconds. |
| `width` | INTEGER | integer | - | The width of the video in pixels. |
| `height` | INTEGER | integer | - | The height of the video in pixels. |
| `status` | STRING | string_default(50) | NOT NULL, DEFAULT `PENDING`, INDEXED | The current status of the video upload and initial processing (e.g., PENDING, UPLOADED, VALIDATED, FAILED). |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **videos_user_id_status_index**: `user_id, status`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `GalleryItem`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Export`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Watermark`
- **belongsToMany()**: Many-to-Many (belongsToMany) ‚Üí `Overlay`

---

### Model

> Represents the underlying AI models used by the filters/effects. This is an internal entity for managing the AI assets.

**Table:** `models`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the AI model. |
| `filter_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `filters.id`, INDEXED | Foreign key linking the model to a specific filter it powers. |
| `name` | STRING | string | NOT NULL | Internal name for the AI model. |
| `version` | STRING | string(50) | NOT NULL | Version of the model, e.g., 'v1.2.0'. |
| `description` | TEXT | text | - | Internal description of the model's capabilities and architecture. |
| `endpoint_url` | STRING | string(2048) | - | The API endpoint URL if the model is hosted as an external microservice. |
| `is_active` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | A soft-toggle to enable or disable the model for processing jobs. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **models_name_version_unique** (UNIQUE): `name, version`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Filter`

---

### Export

> Represents a processed video, the result of applying a filter to an original video. This is the final output that users download or share.

**Table:** `exports`  
**Scope:** TENANT  
**Storage Class:** AI_OUTPUT  
**Lifecycle:** SCHEDULED_EXPIRY  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the export record. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | Foreign key linking to the user who initiated the export. |
| `video_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `videos.id`, NOT NULL, INDEXED | Foreign key linking to the original source video. |
| `filter_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `filters.id`, NOT NULL, INDEXED | Foreign key linking to the filter/effect that was applied. |
| `watermark_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `watermarks.id`, INDEXED | Foreign key linking to the specific watermark design used, if any. |
| `uuid` | UUID | uuid | UNIQUE, NOT NULL, INDEXED | A public-facing, unique identifier for the exported video, used for sharing links. |
| `status` | STRING | string_default(50) | NOT NULL, DEFAULT `PENDING`, INDEXED | The current status of the export job (e.g., PENDING, PROCESSING, COMPLETED, FAILED). |
| `storage_path` | STRING | string(1024) | - | The path to the final processed video file in cloud storage. |
| `file_size` | BIGINT | unsigned_big_integer | - | The size of the exported video file in bytes. |
| `with_watermark` | BOOLEAN | boolean | NOT NULL, DEFAULT `true` | Indicates whether the exported video includes a watermark. |
| `is_public` | BOOLEAN | boolean | NOT NULL, DEFAULT `false`, INDEXED | Flag indicating if the user has published this video to the public 'Explore' gallery. |
| `public_title` | STRING | string | üîí PII, üîê ENCRYPTED | The user-provided title for the video when published to the public gallery. |
| `public_tags` | JSON | json | - | User-provided tags for discoverability in the public gallery. |
| `expires_at` | TIMESTAMP | timestamp | INDEXED | Timestamp for when the exported video file should be automatically cleaned up, especially for free-tier users. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **exports_user_id_status_index**: `user_id, status`
- **exports_is_public_created_at_index**: `is_public, created_at`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Video`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Filter`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Watermark`

---

### Style

> Manages visual styles for UI elements, particularly for animated watermarks, frames, or overlays that can be applied to videos.

**Table:** `styles`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the style. |
| `name` | STRING | string | UNIQUE, NOT NULL | The public-facing name of the style (e.g., 'Neon Glow Frame'). |
| `description` | TEXT | text | - | A brief description of the style's appearance or animation. |
| `type` | STRING | string_default(50) | NOT NULL, DEFAULT `WATERMARK`, INDEXED | The type of style, used for categorization (e.g., WATERMARK, FRAME, OVERLAY). |
| `css_properties_json` | JSON | json | - | Stores CSS or animation properties (e.g., for Lottie) to render the style on the front-end. |
| `preview_image_url` | STRING | string(2048) | - | URL to a preview image or GIF that demonstrates the style. |
| `is_premium` | BOOLEAN | boolean | NOT NULL, DEFAULT `false`, INDEXED | Flag indicating if this style is a premium-only option. |
| `is_active` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | A soft-toggle to enable or disable the style's availability to users. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **styles_type_is_premium_is_active_index**: `type, is_premium, is_active`

---

### Effect

> Represents an AI-powered visual effect that can be applied to a video. Effects can be categorized, marked as premium, and have configurable parameters.

**Table:** `effects`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the effect. |
| `name` | STRING | string | NOT NULL | The user-facing name of the effect (e.g., 'Snowfall Overlay'). |
| `slug` | STRING | string | UNIQUE, NOT NULL, INDEXED | A URL-friendly version of the effect name for use in routes. |
| `description` | TEXT | text | - | A detailed description of what the effect does and its best use cases. |
| `category_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `categories.id`, INDEXED | Foreign key linking to the categories table to group effects. |
| `preview_video_url` | STRING | string(2048) | - | URL to a sample video file showcasing the effect in action. |
| `is_premium` | BOOLEAN | boolean | NOT NULL, DEFAULT `false`, INDEXED | Flag indicating if this effect requires a premium subscription to use. |
| `is_active` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | Toggles the visibility and availability of the effect in the application. |
| `parameters_schema` | JSON | json | - | JSON schema defining user-configurable parameters for the effect, like intensity or color. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **effects_slug_unique** (UNIQUE): `slug`
- **effects_category_id_index**: `category_id`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Category`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `GalleryItem`
- **morphToMany()**: Polymorphic (morphTo/morphMany) ‚Üí `Tag`

---

### Package

> Represents a purchasable item, such as a subscription plan, a credit pack, or a one-time export. This is a central entity for monetization.

**Table:** `packages`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the package. |
| `name` | STRING | string | NOT NULL | The user-facing name of the package (e.g., 'Pro Monthly', '5 Export Credits'). |
| `slug` | STRING | string | UNIQUE, NOT NULL, INDEXED | A unique, URL-friendly identifier for the package. |
| `description` | TEXT | text | - | A description of the package's benefits and features. |
| `type` | STRING | string(50) | NOT NULL, INDEXED | The type of package, e.g., 'subscription', 'credit_pack', 'one_time'. |
| `price` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The price of the package in the specified currency. |
| `currency` | STRING | string(3) | NOT NULL, DEFAULT `USD` | The ISO 4217 currency code for the price. |
| `credits_granted` | INTEGER | integer | - | Number of credits this package provides, if applicable. |
| `is_active` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | Toggles whether this package is currently available for purchase. |
| `stripe_price_id` | STRING | string | INDEXED | The corresponding price ID from the Stripe payment provider. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **packages_slug_unique** (UNIQUE): `slug`
- **packages_type_is_active_index**: `type, is_active`

#### Eloquent Relationships

- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Subscription`
- **belongsToMany()**: Many-to-Many (belongsToMany) ‚Üí `Watermark`
- **belongsToMany()**: Many-to-Many (belongsToMany) ‚Üí `Overlay`

---

### Reward

> Represents a reward unlocked by a user, often tied to a milestone, to encourage engagement and retention.

**Table:** `rewards`  
**Scope:** USER_PRIVATE  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the reward. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | The user who received this reward. |
| `milestone_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `milestones.id`, INDEXED | The milestone that triggered this reward, if any. |
| `name` | STRING | string | NOT NULL | The user-facing name of the reward (e.g., '20% Off Coupon'). |
| `description` | TEXT | text | - | A description of what the reward is. |
| `type` | STRING | string(50) | NOT NULL, INDEXED | The type of reward, e.g., 'discount_coupon', 'free_export', 'credit_bonus'. |
| `value` | JSON | json | - | JSON object storing the reward's value, e.g., {'percentage': 20} or {'credits': 100}. |
| `unlocked_at` | TIMESTAMP | timestamp | NOT NULL, DEFAULT `CURRENT_TIMESTAMP` | Timestamp of when the user earned the reward. |
| `claimed_at` | TIMESTAMP | timestamp | INDEXED | Timestamp of when the user used or claimed the reward. |
| `expires_at` | TIMESTAMP | timestamp | INDEXED | Timestamp indicating when the reward expires, if applicable. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Indexes

- **rewards_user_id_type_index**: `user_id, type`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Milestone`

---

### Tag

> A simple tag that can be applied polymorphically to other entities (like effects or gallery items) for categorization and search.

**Table:** `tags`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the tag. |
| `name` | STRING | string | UNIQUE, NOT NULL | The display name of the tag. |
| `slug` | STRING | string | UNIQUE, NOT NULL, INDEXED | A URL-friendly, unique version of the tag name. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **tags_name_unique** (UNIQUE): `name`
- **tags_slug_unique** (UNIQUE): `slug`

#### Eloquent Relationships

- **morphedByMany()**: Polymorphic (morphTo/morphMany) ‚Üí `Effect`

---

### Subscription

> Manages user subscriptions to premium plans, tracking status, billing periods, and links to the payment provider.

**Table:** `subscriptions`  
**Scope:** USER_PRIVATE  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the subscription. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | The user who owns this subscription. |
| `package_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `packages.id`, NOT NULL, INDEXED | The subscription plan/package the user is subscribed to. |
| `stripe_subscription_id` | STRING | string | UNIQUE, NOT NULL, INDEXED | The unique subscription identifier from the Stripe payment provider. |
| `status` | STRING | string(50) | NOT NULL, INDEXED | The current status of the subscription (e.g., 'active', 'cancelled', 'trialing', 'past_due'). |
| `trial_ends_at` | TIMESTAMP | timestamp | - | The date and time when the trial period ends, if applicable. |
| `period_start` | TIMESTAMP | timestamp | NOT NULL | The start date and time of the current billing period. |
| `period_end` | TIMESTAMP | timestamp | NOT NULL | The end date and time of the current billing period. |
| `cancelled_at` | TIMESTAMP | timestamp | - | The date and time when the subscription was cancelled by the user. |
| `ends_at` | TIMESTAMP | timestamp | - | The date and time when the subscription will fully expire and access will be revoked. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **subscriptions_stripe_subscription_id_unique** (UNIQUE): `stripe_subscription_id`
- **subscriptions_user_id_status_index**: `user_id, status`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Package`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`

---

### Overlay

> Represents visual overlays like weather effects or decorative frames that can be applied to videos. These are distinct from branding watermarks.

**Table:** `overlays`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the overlay. |
| `name` | STRING | string | UNIQUE, NOT NULL, INDEXED | The unique name of the overlay, e.g., 'Snowfall Overlay'. |
| `description` | TEXT | text | - | A brief description of the overlay's visual effect. |
| `preview_url` | STRING | string(2048) | NOT NULL | URL to a preview image or short video of the overlay. |
| `asset_url` | STRING | string(2048) | NOT NULL | URL to the actual overlay asset file stored in cloud storage (e.g., S3). |
| `type` | STRING | string(50) | NOT NULL, DEFAULT `general`, INDEXED | Categorization of the overlay, e.g., 'weather', 'frame', 'style'. |
| `is_premium` | BOOLEAN | boolean | NOT NULL, DEFAULT `false`, INDEXED | Flag indicating if this overlay requires a premium subscription. |
| `default_settings` | JSON | json | - | Default parameters for the overlay, such as opacity, position, or intensity. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Indexes

- **overlays_name_unique** (UNIQUE): `name`
- **overlays_type_index**: `type`
- **overlays_is_premium_index**: `is_premium`

#### Eloquent Relationships

- **belongsToMany()**: Many-to-Many (belongsToMany) ‚Üí `Package`
- **belongsToMany()**: Many-to-Many (belongsToMany) ‚Üí `Video`

---

### Watermark

> Defines available watermark designs (free and premium) that can be applied to user videos for branding and monetization.

**Table:** `watermarks`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the watermark design. |
| `name` | STRING | string | UNIQUE, NOT NULL, INDEXED | The unique name of the watermark design, e.g., 'Classic Lower-Third'. |
| `description` | TEXT | text | - | A brief description of the watermark's style and appearance. |
| `preview_url` | STRING | string(2048) | NOT NULL | URL to a preview image or short video of the watermark. |
| `asset_url` | STRING | string(2048) | NOT NULL | URL to the actual watermark asset file (e.g., an animated overlay) stored in cloud storage. |
| `is_premium` | BOOLEAN | boolean | NOT NULL, DEFAULT `false`, INDEXED | Flag indicating if this watermark design requires a premium subscription. |
| `is_animated` | BOOLEAN | boolean | NOT NULL, DEFAULT `false` | Flag indicating if the watermark has animation. |
| `default_settings` | JSON | json | - | Default parameters for the watermark, such as opacity, position, and default text content. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Indexes

- **watermarks_name_unique** (UNIQUE): `name`
- **watermarks_is_premium_index**: `is_premium`

#### Eloquent Relationships

- **belongsToMany()**: Many-to-Many (belongsToMany) ‚Üí `Package`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Video`

---

## Eloquent Relationships

### One-to-Many (hasMany/belongsTo)

- **User**::hasMany() ‚Üí **CreditTransaction** (through `null`)  
  FK: `user_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **CreditTransaction**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **User**::hasMany() ‚Üí **Purchase** (through `null`)  
  FK: `user_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Purchase**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **Discount**::hasMany() ‚Üí **Purchase** (through `null`)  
  FK: `discount_id`

- **Purchase**::belongsTo() ‚Üí **Discount** (through `null`)  
  FK: `discount_id`

- **User**::hasMany() ‚Üí **Milestone** (through `null`)  
  FK: `user_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Milestone**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **Category**::belongsTo() ‚Üí **Category** (through `null`)  
  FK: `parent_id`

- **Category**::hasMany() ‚Üí **Category** (through `null`)  
  FK: `parent_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **GalleryItem**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **GalleryItem**::belongsTo() ‚Üí **Video** (through `null`)  
  FK: `video_id`

- **GalleryItem**::belongsTo() ‚Üí **Effect** (through `null`)  
  FK: `effect_id`

- **Payment**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **Payment**::belongsTo() ‚Üí **Purchase** (through `null`)  
  FK: `purchase_id`

- **Filter**::belongsTo() ‚Üí **Category** (through `null`)  
  FK: `category_id`

- **Filter**::hasMany() ‚Üí **Model** (through `null`)  
  FK: `filter_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Filter**::hasMany() ‚Üí **Export** (through `null`)  
  FK: `filter_id`

- **Video**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **Video**::hasMany() ‚Üí **GalleryItem** (through `null`)  
  FK: `video_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Video**::hasMany() ‚Üí **Export** (through `null`)  
  FK: `video_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Model**::belongsTo() ‚Üí **Filter** (through `null`)  
  FK: `filter_id`

- **Export**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **Export**::belongsTo() ‚Üí **Video** (through `null`)  
  FK: `video_id`

- **Export**::belongsTo() ‚Üí **Filter** (through `null`)  
  FK: `filter_id`

- **Export**::belongsTo() ‚Üí **Watermark** (through `null`)  
  FK: `watermark_id`

- **Effect**::belongsTo() ‚Üí **Category** (through `null`)  
  FK: `category_id`

- **Effect**::hasMany() ‚Üí **GalleryItem** (through `null`)  
  FK: `effect_id`

- **Package**::hasMany() ‚Üí **Subscription** (through `null`)  
  FK: `package_id`

- **Subscription**::belongsTo() ‚Üí **Package** (through `null`)  
  FK: `package_id`

- **Subscription**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **User**::hasMany() ‚Üí **Subscription** (through `null`)  
  FK: `user_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Reward**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **User**::hasMany() ‚Üí **Reward** (through `null`)  
  FK: `user_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Reward**::belongsTo() ‚Üí **Milestone** (through `null`)  
  FK: `milestone_id`

- **Milestone**::hasMany() ‚Üí **Reward** (through `null`)  
  FK: `milestone_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Watermark**::hasMany() ‚Üí **Video** (through `null`)  
  FK: `watermark_id`

- **Video**::belongsTo() ‚Üí **Watermark** (through `null`)  
  FK: `watermark_id`

### Polymorphic (morphTo/morphMany)

- **CreditTransaction**::morphTo() ‚Üí **RelatedItem** (through `null`)  
  FK: `related_id`

- **Purchase**::morphTo() ‚Üí **PurchasableItem** (through `null`)  
  FK: `purchasable_id`

- **Tier**::morphMany() ‚Üí **Purchase** (through `null`)  
  FK: `purchasable`

- **Tag**::morphedByMany() ‚Üí **Effect** (through `taggables`)  
  FK: `tag_id`

- **Effect**::morphToMany() ‚Üí **Tag** (through `taggables`)  
  FK: `taggable_id`

### Many-to-Many (belongsToMany)

- **Package**::belongsToMany() ‚Üí **Watermark** (through `package_watermark`)  
  FK: `package_id`

- **Watermark**::belongsToMany() ‚Üí **Package** (through `package_watermark`)  
  FK: `watermark_id`

- **Package**::belongsToMany() ‚Üí **Overlay** (through `package_overlay`)  
  FK: `package_id`

- **Overlay**::belongsToMany() ‚Üí **Package** (through `package_overlay`)  
  FK: `overlay_id`

- **Overlay**::belongsToMany() ‚Üí **Video** (through `overlay_video`)  
  FK: `overlay_id`

- **Video**::belongsToMany() ‚Üí **Overlay** (through `overlay_video`)  
  FK: `video_id`

---

## Indexes Strategy

**Strategy:** IndexStrategy[autoIndexForeignKeys=true, autoIndexTimestamps=false, alwaysIndexFields=[status, type], entityIndexes={}, recommendations=[]]

### Entity Indexes

#### credit_transactions

- `credit_transactions_related_poly_index`: related_id, related_type (BTREE)
- Field index on `id`
- Field index on `type`
- Field index on `related_id`
- Field index on `related_type`

#### purchases

- `purchases_purchasable_poly_index`: purchasable_id, purchasable_type (BTREE)
- Field index on `id`
- Field index on `purchasable_id`
- Field index on `purchasable_type`
- Field index on `status`
- Field index on `provider_transaction_id`

#### users

- Field index on `id`
- Field index on `email`

#### discounts

- Field index on `id`
- Field index on `code`
- Field index on `is_active`

#### categories

- Field index on `id`
- Field index on `name`
- Field index on `slug`
- Field index on `is_visible`

#### backgrounds

- Field index on `id`
- Field index on `is_default`

#### tiers

- Field index on `id`
- Field index on `is_active`

#### milestones

- `milestones_user_id_name_unique` **UNIQUE**: user_id, name (BTREE)
- Field index on `id`

#### gallery_items

- Field index on `id`
- Field index on `is_public`
- Field index on `view_count`

#### payments

- Field index on `id`
- Field index on `status`
- Field index on `provider`
- Field index on `provider_transaction_id`

#### filters

- `filters_category_id_index`: category_id (BTREE)
- `filters_is_premium_is_active_index`: is_premium, is_active (BTREE)
- Field index on `id`
- Field index on `is_premium`
- Field index on `is_active`

#### videos

- `videos_user_id_status_index`: user_id, status (BTREE)
- Field index on `id`
- Field index on `uuid`
- Field index on `status`

#### models

- `models_name_version_unique` **UNIQUE**: name, version (BTREE)
- Field index on `id`
- Field index on `is_active`

#### exports

- `exports_user_id_status_index`: user_id, status (BTREE)
- `exports_is_public_created_at_index`: is_public, created_at (BTREE)
- Field index on `id`
- Field index on `uuid`
- Field index on `status`
- Field index on `is_public`
- Field index on `expires_at`

#### styles

- `styles_type_is_premium_is_active_index`: type, is_premium, is_active (BTREE)
- Field index on `id`
- Field index on `type`
- Field index on `is_premium`
- Field index on `is_active`

#### effects

- `effects_slug_unique` **UNIQUE**: slug (BTREE)
- `effects_category_id_index`: category_id (BTREE)
- Field index on `id`
- Field index on `slug`
- Field index on `is_premium`
- Field index on `is_active`

#### packages

- `packages_slug_unique` **UNIQUE**: slug (BTREE)
- `packages_type_is_active_index`: type, is_active (BTREE)
- Field index on `id`
- Field index on `slug`
- Field index on `type`
- Field index on `is_active`
- Field index on `stripe_price_id`

#### rewards

- `rewards_user_id_type_index`: user_id, type (BTREE)
- Field index on `id`
- Field index on `type`
- Field index on `claimed_at`
- Field index on `expires_at`

#### tags

- `tags_name_unique` **UNIQUE**: name (BTREE)
- `tags_slug_unique` **UNIQUE**: slug (BTREE)
- Field index on `id`
- Field index on `slug`

#### subscriptions

- `subscriptions_stripe_subscription_id_unique` **UNIQUE**: stripe_subscription_id (BTREE)
- `subscriptions_user_id_status_index`: user_id, status (BTREE)
- Field index on `id`
- Field index on `stripe_subscription_id`
- Field index on `status`

#### overlays

- `overlays_name_unique` **UNIQUE**: name (BTREE)
- `overlays_type_index`: type (BTREE)
- `overlays_is_premium_index`: is_premium (BTREE)
- Field index on `id`
- Field index on `name`
- Field index on `type`
- Field index on `is_premium`

#### watermarks

- `watermarks_name_unique` **UNIQUE**: name (BTREE)
- `watermarks_is_premium_index`: is_premium (BTREE)
- Field index on `id`
- Field index on `name`
- Field index on `is_premium`

---

## Schema Remarks

- Schema generated from PCD analysis
- Total entities: 22
- Total relationships: 49
- Coverage mapped: 22 entities
- User email and name are marked as PII and should be encrypted at rest.
- Password fields must be hashed using a strong, modern algorithm like bcrypt.
- All monetary values are stored as DECIMAL to prevent floating-point inaccuracies.
- Polymorphic relationships are used for purchases and credit transactions to allow linking to various types of related models.
- All monetary values are stored as DECIMAL(10, 2) to ensure precision for financial calculations.
- Foreign key constraints assume the existence of 'users', 'rewards', 'videos', 'effects', and 'purchases' tables.
- Soft deletes are enabled on Tiers to allow for graceful retirement of subscription plans without breaking existing user subscriptions.
- The 'Style' entity is designed to manage the watermark/frame designs described in the context.
- The 'Export' entity represents the final processed video, which has a scheduled expiry lifecycle for free-tier users.
- The 'Video' entity represents the original user upload, which is kept separate from the processed 'Export'.
- The 'Filter' entity corresponds to the AI Effects in the library.
- The 'Model' entity is an internal representation of the AI models that power the filters.
- A polymorphic pivot table 'taggables' will be required to link Tags to other models like Effects and Gallery Items.
- The 'subscriptions' table is designed to integrate with a payment provider like Stripe, storing key identifiers and status information.
- Monetary values in the 'packages' table use DECIMAL type for precision, which is critical for financial data.
- Overlays represent creative visual additions (like weather), while Watermarks are specifically for branding and monetization. Both are stored as global, reusable assets.
- The 'CreditTransaction' entity has a polymorphic 'related' relationship (morphTo), allowing it to be associated with various models. 'RelatedItem' is a placeholder for the target entity.
- The 'Purchase' entity has a polymorphic 'purchasable' relationship (morphTo), allowing different items like 'Tier' or 'Package' to be bought. 'PurchasableItem' is a placeholder for the target entity.
- The 'Tier' entity can be the target of a 'Purchase' via a polymorphic one-to-many relationship (morphMany).
- The 'Category' entity has a self-referencing relationship using 'parent_id' to model parent-child hierarchies.
- The 'Style' entity lacks foreign keys to other entities in the provided schema, so no relationships have been defined for it.
- Cascade delete is enabled for relationships where child entities (e.g., Export, GalleryItem) are logically dependent on the parent's (e.g., Video) existence.
- Cascade delete is disabled for relationships where child records might need to be preserved for archival purposes even if the parent is removed (e.g., Filter -> Export).
- All 'belongsTo' relationships are categorized under the 'ONE_TO_MANY' type, representing the inverse side of the relationship.
- The 'through_entity' is set to null for all relationships as no many-to-many pivot tables were identified for the focus entities.
- The relationship between Tag and Effect is inferred as a polymorphic many-to-many based on the context mentioning tags for searching effects.
- Relationships between Package and Watermark/Overlay are inferred as many-to-many based on the monetization strategy of selling 'design packs'.
- Relationships between Video and Watermark/Overlay are inferred from the core functionality of applying these assets to processed videos. A video has one watermark but can have multiple overlays.

## Retrieval Query Examples

> Practical query examples for retrieving data. These can be used by engineering teams and AI tools.

### CreditTransaction

**Basic Retrieval**

```sql
-- Get all CreditTransactions with pagination
SELECT * FROM credit_transactions
WHERE tenant_id = :tenant_id
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$creditTransactions = CreditTransaction::query()
    ->where('tenant_id', $tenantId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM credit_transactions
WHERE id = :id;
```

```php
$creditTransaction = CreditTransaction::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$creditTransactions = CreditTransaction::query()
    ->with(['belongsTo', 'morphTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$creditTransactions = CreditTransaction::query()
    ->where(function ($query) use ($search) {
        $query->where('type', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('related_type', 'like', "%{$search}%");
    })
    ->get();
```

---

### Purchase

**Basic Retrieval**

```sql
-- Get all Purchases with pagination
SELECT * FROM purchases
WHERE tenant_id = :tenant_id
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$purchases = Purchase::query()
    ->where('tenant_id', $tenantId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM purchases
WHERE id = :id;
```

```php
$purchase = Purchase::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$purchases = Purchase::query()
    ->with(['belongsTo', 'morphTo', 'belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$purchases = Purchase::query()
    ->where(function ($query) use ($search) {
        $query->where('purchasable_type', 'like', "%{$search}%")
              ->orWhere('currency', 'like', "%{$search}%")
              ->orWhere('status', 'like', "%{$search}%");
    })
    ->get();
```

---

### User

**Basic Retrieval**

```sql
-- Get all Users with pagination
SELECT * FROM users
WHERE tenant_id = :tenant_id
  AND deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$users = User::query()
    ->where('tenant_id', $tenantId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM users
WHERE id = :id AND deleted_at IS NULL;
```

```php
$user = User::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$users = User::query()
    ->with(['hasMany', 'hasMany', 'hasMany', 'hasMany', 'hasMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$users = User::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('email', 'like', "%{$search}%")
              ->orWhere('remember_token', 'like', "%{$search}%");
    })
    ->get();
```

---

### Discount

**Basic Retrieval**

```sql
-- Get all Discounts with pagination
SELECT * FROM discounts
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$discounts = Discount::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM discounts
WHERE id = :id;
```

```php
$discount = Discount::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$discounts = Discount::query()
    ->with(['hasMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$discounts = Discount::query()
    ->where(function ($query) use ($search) {
        $query->where('code', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('type', 'like', "%{$search}%");
    })
    ->get();
```

---

### Category

**Basic Retrieval**

```sql
-- Get all Categorys with pagination
SELECT * FROM categories
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$categorys = Category::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM categories
WHERE id = :id;
```

```php
$category = Category::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$categorys = Category::query()
    ->with(['belongsTo', 'hasMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$categorys = Category::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('slug', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%");
    })
    ->get();
```

---

### Background

**Basic Retrieval**

```sql
-- Get all Backgrounds with pagination
SELECT * FROM backgrounds
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$backgrounds = Background::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM backgrounds
WHERE id = :id;
```

```php
$background = Background::findOrFail($id);
```

**Search Query**

```php
// Search across text fields
$backgrounds = Background::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('image_url', 'like', "%{$search}%");
    })
    ->get();
```

---

### Tier

**Basic Retrieval**

```sql
-- Get all Tiers with pagination
SELECT * FROM tiers
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$tiers = Tier::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM tiers
WHERE id = :id AND deleted_at IS NULL;
```

```php
$tier = Tier::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$tiers = Tier::query()
    ->with(['morphMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$tiers = Tier::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%");
    })
    ->get();
```

---

### Milestone

**Basic Retrieval**

```sql
-- Get all Milestones with pagination
SELECT * FROM milestones
WHERE user_id = :user_id
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$milestones = Milestone::query()
    ->where('user_id', $userId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM milestones
WHERE id = :id;
```

```php
$milestone = Milestone::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$milestones = Milestone::query()
    ->with(['belongsTo', 'hasMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$milestones = Milestone::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%");
    })
    ->get();
```

---

### GalleryItem

**Basic Retrieval**

```sql
-- Get all GalleryItems with pagination
SELECT * FROM gallery_items
  AND deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$galleryItems = GalleryItem::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM gallery_items
WHERE id = :id AND deleted_at IS NULL;
```

```php
$galleryItem = GalleryItem::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$galleryItems = GalleryItem::query()
    ->with(['belongsTo', 'belongsTo', 'belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$galleryItems = GalleryItem::query()
    ->where(function ($query) use ($search) {
        $query->where('title', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%");
    })
    ->get();
```

---

### Payment

**Basic Retrieval**

```sql
-- Get all Payments with pagination
SELECT * FROM payments
WHERE user_id = :user_id
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$payments = Payment::query()
    ->where('user_id', $userId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM payments
WHERE id = :id;
```

```php
$payment = Payment::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$payments = Payment::query()
    ->with(['belongsTo', 'belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$payments = Payment::query()
    ->where(function ($query) use ($search) {
        $query->where('currency', 'like', "%{$search}%")
              ->orWhere('status', 'like', "%{$search}%")
              ->orWhere('provider', 'like', "%{$search}%");
    })
    ->get();
```

---

### Filter

**Basic Retrieval**

```sql
-- Get all Filters with pagination
SELECT * FROM filters
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$filters = Filter::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM filters
WHERE id = :id AND deleted_at IS NULL;
```

```php
$filter = Filter::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$filters = Filter::query()
    ->with(['belongsTo', 'hasMany', 'hasMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$filters = Filter::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('preview_video_url', 'like', "%{$search}%");
    })
    ->get();
```

---

### Video

**Basic Retrieval**

```sql
-- Get all Videos with pagination
SELECT * FROM videos
WHERE tenant_id = :tenant_id
  AND deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$videos = Video::query()
    ->where('tenant_id', $tenantId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM videos
WHERE id = :id AND deleted_at IS NULL;
```

```php
$video = Video::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$videos = Video::query()
    ->with(['belongsTo', 'hasMany', 'hasMany', 'belongsTo', 'belongsToMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$videos = Video::query()
    ->where(function ($query) use ($search) {
        $query->where('original_filename', 'like', "%{$search}%")
              ->orWhere('storage_path', 'like', "%{$search}%")
              ->orWhere('mime_type', 'like', "%{$search}%");
    })
    ->get();
```

---

### Model

**Basic Retrieval**

```sql
-- Get all Models with pagination
SELECT * FROM models
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$models = Model::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM models
WHERE id = :id AND deleted_at IS NULL;
```

```php
$model = Model::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$models = Model::query()
    ->with(['belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$models = Model::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('version', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%");
    })
    ->get();
```

---

### Export

**Basic Retrieval**

```sql
-- Get all Exports with pagination
SELECT * FROM exports
WHERE tenant_id = :tenant_id
  AND deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$exports = Export::query()
    ->where('tenant_id', $tenantId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM exports
WHERE id = :id AND deleted_at IS NULL;
```

```php
$export = Export::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$exports = Export::query()
    ->with(['belongsTo', 'belongsTo', 'belongsTo', 'belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$exports = Export::query()
    ->where(function ($query) use ($search) {
        $query->where('status', 'like', "%{$search}%")
              ->orWhere('storage_path', 'like', "%{$search}%")
              ->orWhere('public_title', 'like', "%{$search}%");
    })
    ->get();
```

---

### Style

**Basic Retrieval**

```sql
-- Get all Styles with pagination
SELECT * FROM styles
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$styles = Style::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM styles
WHERE id = :id AND deleted_at IS NULL;
```

```php
$style = Style::findOrFail($id);
```

**Search Query**

```php
// Search across text fields
$styles = Style::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('type', 'like', "%{$search}%");
    })
    ->get();
```

---

### Effect

**Basic Retrieval**

```sql
-- Get all Effects with pagination
SELECT * FROM effects
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$effects = Effect::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM effects
WHERE id = :id AND deleted_at IS NULL;
```

```php
$effect = Effect::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$effects = Effect::query()
    ->with(['belongsTo', 'hasMany', 'morphToMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$effects = Effect::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('slug', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%");
    })
    ->get();
```

---

### Package

**Basic Retrieval**

```sql
-- Get all Packages with pagination
SELECT * FROM packages
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$packages = Package::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM packages
WHERE id = :id AND deleted_at IS NULL;
```

```php
$package = Package::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$packages = Package::query()
    ->with(['hasMany', 'belongsToMany', 'belongsToMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$packages = Package::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('slug', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%");
    })
    ->get();
```

---

### Reward

**Basic Retrieval**

```sql
-- Get all Rewards with pagination
SELECT * FROM rewards
WHERE user_id = :user_id
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$rewards = Reward::query()
    ->where('user_id', $userId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM rewards
WHERE id = :id;
```

```php
$reward = Reward::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$rewards = Reward::query()
    ->with(['belongsTo', 'belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$rewards = Reward::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('type', 'like', "%{$search}%");
    })
    ->get();
```

---

### Tag

**Basic Retrieval**

```sql
-- Get all Tags with pagination
SELECT * FROM tags
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$tags = Tag::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM tags
WHERE id = :id AND deleted_at IS NULL;
```

```php
$tag = Tag::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$tags = Tag::query()
    ->with(['morphedByMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$tags = Tag::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('slug', 'like', "%{$search}%");
    })
    ->get();
```

---

### Subscription

**Basic Retrieval**

```sql
-- Get all Subscriptions with pagination
SELECT * FROM subscriptions
WHERE user_id = :user_id
  AND deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$subscriptions = Subscription::query()
    ->where('user_id', $userId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM subscriptions
WHERE id = :id AND deleted_at IS NULL;
```

```php
$subscription = Subscription::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$subscriptions = Subscription::query()
    ->with(['belongsTo', 'belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$subscriptions = Subscription::query()
    ->where(function ($query) use ($search) {
        $query->where('stripe_subscription_id', 'like', "%{$search}%")
              ->orWhere('status', 'like', "%{$search}%");
    })
    ->get();
```

---

### Overlay

**Basic Retrieval**

```sql
-- Get all Overlays with pagination
SELECT * FROM overlays
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$overlays = Overlay::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM overlays
WHERE id = :id;
```

```php
$overlay = Overlay::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$overlays = Overlay::query()
    ->with(['belongsToMany', 'belongsToMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$overlays = Overlay::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('preview_url', 'like', "%{$search}%");
    })
    ->get();
```

---

### Watermark

**Basic Retrieval**

```sql
-- Get all Watermarks with pagination
SELECT * FROM watermarks
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$watermarks = Watermark::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM watermarks
WHERE id = :id;
```

```php
$watermark = Watermark::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$watermarks = Watermark::query()
    ->with(['belongsToMany', 'hasMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$watermarks = Watermark::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('preview_url', 'like', "%{$search}%");
    })
    ->get();
```

---

