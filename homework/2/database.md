# Database Schema Documentation

**Generated by Schema Tool v2**

---

## Table of Contents

1. [Coverage Summary](#coverage-summary)
2. [Entity Definitions](#entity-definitions)
   - [GalleryVideo](#galleryvideo)
   - [Purchase](#purchase)
   - [User](#user)
   - [Discount](#discount)
   - [Category](#category)
   - [Tier](#tier)
   - [Algorithm](#algorithm)
   - [Payment](#payment)
   - [Filter](#filter)
   - [Video](#video)
   - [AiModel](#aimodel)
   - [Export](#export)
   - [Style](#style)
   - [Effect](#effect)
   - [Package](#package)
   - [Reward](#reward)
   - [Tag](#tag)
   - [Subscription](#subscription)
   - [Overlay](#overlay)
   - [Watermark](#watermark)
   - [File](#file)
3. [Eloquent Relationships](#eloquent-relationships)
4. [Indexes Strategy](#indexes-strategy)
5. [Schema Remarks](#schema-remarks)
6. [Scalability Analysis](#scalability-analysis)
7. [Retrieval Query Examples](#retrieval-query-examples)

---

## Coverage Summary

| Entity | Table | Coverage Type | Plugin/Package | Migration Action |
|--------|-------|---------------|----------------|------------------|
| GalleryVideo | `gallery_videos` | CUSTOM | `N/A` | **create** |
| Purchase | `purchases` | CUSTOM | `N/A` | **create** |
| User | `users` | CUSTOM | `N/A` | **create** |
| Discount | `discounts` | CUSTOM | `N/A` | **create** |
| Category | `categories` | CUSTOM | `N/A` | **create** |
| Tier | `tiers` | CUSTOM | `N/A` | **create** |
| Algorithm | `algorithms` | CUSTOM | `N/A` | **create** |
| Payment | `payments` | CUSTOM | `N/A` | **create** |
| Filter | `filters` | CUSTOM | `N/A` | **create** |
| Video | `videos` | CUSTOM | `N/A` | **create** |
| Model | `models` | CUSTOM | `N/A` | **create** |
| Export | `exports` | CUSTOM | `N/A` | **create** |
| Style | `styles` | CUSTOM | `N/A` | **create** |
| Effect | `effects` | CUSTOM | `N/A` | **create** |
| Package | `packages` | CUSTOM | `N/A` | **create** |
| Reward | `rewards` | CUSTOM | `N/A` | **create** |
| Tag | `tags` | CUSTOM | `N/A` | **create** |
| Subscription | `subscriptions` | CUSTOM | `N/A` | **create** |
| Overlay | `overlays` | CUSTOM | `N/A` | **create** |
| Watermark | `watermarks` | CUSTOM | `N/A` | **create** |
| File | `files` | CUSTOM | `N/A` | **create** |

### Coverage Types

- **CORE**: Standard Laravel application entity
- **PLUGIN_FULL**: Fully managed by Laravel plugin
- **PLUGIN_AUGMENTED**: Plugin entity with custom fields
- **THIRD_PARTY**: External service integration

---

## Entity Definitions

### GalleryVideo

> Represents a user's processed video that has been published to the public 'Explore' gallery for discovery by other users.

**Table:** `gallery_videos`  
**Scope:** USER_SHARED  
**Storage Class:** AI_OUTPUT  
**Lifecycle:** SOFT_DELETE  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, NOT NULL, INDEXED | Primary key for the gallery video entry. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | The user who created and published the video. |
| `video_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `videos.id`, UNIQUE, NOT NULL, INDEXED | The processed video being published. A video can only be in the gallery once. |
| `title` | STRING | string | NOT NULL | The user-provided title for the video in the gallery. |
| `is_public` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | Controls the visibility of the video in the public gallery. Indexed for efficient querying of public content. |
| `tags` | JSON | json | - | User-provided tags for categorization and search in the gallery. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **gallery_videos_is_public_created_at_index**: `is_public, created_at`
- **idx_gallery_videos_deleted_at**: `deleted_at`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`

---

### Purchase

> Records a user's transaction for a premium package, one-time export, or subscription, including any applied discounts.

**Table:** `purchases`  
**Scope:** USER_PRIVATE  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, NOT NULL, INDEXED | Primary key for the purchase record. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | The user who made the purchase. |
| `package_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `packages.id`, NOT NULL, INDEXED | The package or product that was purchased. |
| `original_amount` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The original price of the package before any discounts. |
| `applied_discount_amount` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The amount of discount code value applied to this purchase. |
| `total_amount` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The final amount paid by the user after all discounts. |
| `status` | STRING | string_default(50) | NOT NULL, DEFAULT `pending`, INDEXED | The status of the purchase (e.g., pending, completed, failed, refunded). |
| `external_transaction_id` | STRING | string | UNIQUE, INDEXED | The unique transaction ID from the external payment processor (e.g., Stripe). |
| `processed_at` | TIMESTAMP | timestamp | - | Timestamp of when the payment was successfully processed. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Eloquent Relationships

- **hasOne()**: One-to-One (hasOne/belongsTo) ‚Üí `CreditTransaction`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`

---

### User

> Stores user account information and authentication details.

**Table:** `users`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** SOFT_DELETE  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, NOT NULL, INDEXED | Primary key for the user. |
| `name` | STRING | string | üîí PII, üîê ENCRYPTED | The user's display name. |
| `email` | STRING | string | UNIQUE, NOT NULL, INDEXED, üîí PII, üîê ENCRYPTED | The user's unique email address, used for login and communication. |
| `password_hash_or_social_id` | STRING | string | üîí PII | Stores the hashed password for email-based login or the unique ID from a social provider. |
| `social_provider` | STRING | string(50) | INDEXED | Indicates the social login provider (e.g., 'google', 'tiktok') if used. |
| `authentication_token` | STRING | string(100) | UNIQUE, INDEXED | API token for authenticating stateless requests. |
| `remember_token` | STRING | remember_token | - | Standard Laravel field for 'remember me' functionality. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **users_social_provider_password_hash_or_social_id_index**: `social_provider, password_hash_or_social_id`
- **idx_users_deleted_at**: `deleted_at`

#### Eloquent Relationships

- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `GalleryVideo`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Purchase`
- **belongsToMany()**: Many-to-Many (belongsToMany) ‚Üí `Discount`

---

### Discount

> Represents promotional discount codes (e.g., 'SUMMER20') that can be applied to purchases.

**Table:** `discounts`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, NOT NULL, INDEXED | Primary key for the discount. |
| `code` | STRING | string(100) | UNIQUE, NOT NULL, INDEXED | The unique, case-insensitive code that users enter to receive a discount. |
| `type` | ENUM | enum | NOT NULL, DEFAULT `PERCENTAGE` | The type of discount (e.g., PERCENTAGE, FIXED_AMOUNT). |
| `value` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The value of the discount (e.g., 20.00 for a percentage, or 5.00 for a fixed amount). |
| `expires_at` | TIMESTAMP | timestamp | - | The date and time when the discount code expires. |
| `max_uses` | INTEGER | integer | - | The maximum number of times this code can be used in total. Null for unlimited. |
| `uses` | INTEGER | integer | NOT NULL, DEFAULT `0` | The current number of times this code has been used. |
| `is_active` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | A flag to manually enable or disable the discount code. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Eloquent Relationships

- **belongsToMany()**: Many-to-Many (belongsToMany) ‚Üí `User`

---

### Category

> Groups effects into browsable categories (e.g., 'Backgrounds', 'Weather', 'Style').

**Table:** `categories`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** SOFT_DELETE  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the category. |
| `name` | STRING | string | UNIQUE, NOT NULL, INDEXED | The display name of the category. |
| `slug` | STRING | string | UNIQUE, NOT NULL, INDEXED | A URL-friendly version of the category name. |
| `description` | TEXT | text | - | A brief description of the category's content. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **categories_name_unique** (UNIQUE): `name`
- **categories_slug_unique** (UNIQUE): `slug`
- **idx_categories_deleted_at**: `deleted_at`

#### Eloquent Relationships

- **belongsToMany()**: Many-to-Many (belongsToMany) ‚Üí `Effect`

---

### Tier

> Defines subscription packages and their associated features, pricing, and limits (e.g., Free, Pro).

**Table:** `tiers`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** SOFT_DELETE  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the tier. |
| `name` | STRING | string | UNIQUE, NOT NULL | The display name of the subscription tier (e.g., 'Pro Monthly'). |
| `description` | TEXT | text | - | A description of the tier and its benefits. |
| `price_monthly` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The monthly price for this tier. |
| `price_yearly` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The yearly price for this tier. |
| `features` | JSON | json | - | A JSON object detailing the features and limits of the tier (e.g., resolution, export count). |
| `is_active` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | Indicates if the tier is currently available for purchase. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **tiers_name_unique** (UNIQUE): `name`
- **idx_tiers_deleted_at**: `deleted_at`

#### Eloquent Relationships

- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Subscription`

---

### Algorithm

> Represents a specific AI model or processing algorithm used by an effect, including its version and provider details.

**Table:** `algorithms`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** SOFT_DELETE  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the algorithm. |
| `name` | STRING | string | UNIQUE, NOT NULL | The internal name of the AI algorithm. |
| `version` | STRING | string(50) | NOT NULL, INDEXED | The version of the algorithm (e.g., 'v1.2.0'). |
| `description` | TEXT | text | - | A technical description of the algorithm's function. |
| `provider_name` | STRING | string(100) | NOT NULL, INDEXED | The name of the external service provider for the AI model. |
| `parameters` | JSON | json | - | Default parameters or configuration required by the algorithm. |
| `is_active` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | Indicates if the algorithm is currently enabled for use. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **algorithms_name_version_unique** (UNIQUE): `name, version`
- **idx_algorithms_deleted_at**: `deleted_at`

#### Eloquent Relationships

- **belongsToMany()**: Many-to-Many (belongsToMany) ‚Üí `Effect`

---

### Payment

> Records a financial transaction for a purchase or subscription, tracking status and payment provider details.

**Table:** `payments`  
**Scope:** TENANT  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the payment. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | The user who made the payment. |
| `purchase_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `purchases.id`, NOT NULL, INDEXED | The purchase record this payment is for. |
| `transaction_id` | STRING | string | UNIQUE, NOT NULL, INDEXED | The unique transaction identifier from the payment gateway. |
| `status` | STRING | string(50) | NOT NULL, DEFAULT `pending`, INDEXED | The status of the payment (e.g., pending, completed, failed, refunded). |
| `amount` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The total amount paid. |
| `currency` | STRING | string(3) | NOT NULL, DEFAULT `USD` | The ISO currency code (e.g., USD). |
| `payment_gateway` | STRING | string(50) | NOT NULL, INDEXED | The payment gateway used for the transaction (e.g., 'Stripe'). |
| `processed_at` | TIMESTAMP | timestamp | - | Timestamp of when the payment was successfully processed. |
| `metadata` | JSON | json | - | Additional data from the payment gateway. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Indexes

- **payments_transaction_id_unique** (UNIQUE): `transaction_id`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`
- **belongsTo()**: One-to-One (hasOne/belongsTo) ‚Üí `Purchase`

---

### Filter

> Represents a stylistic visual filter that can be applied to videos, such as color grading or retro effects.

**Table:** `filters`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** SOFT_DELETE  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the filter. |
| `name` | STRING | string | UNIQUE, NOT NULL | The display name of the filter. |
| `description` | TEXT | text | - | A brief description of the filter's visual effect. |
| `category_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `categories.id`, INDEXED | The category this filter belongs to. |
| `parameters` | JSON | json | NOT NULL, DEFAULT `{}` | JSON object containing the filter's settings (e.g., contrast, saturation). |
| `thumbnail_url` | STRING | string(2048) | - | URL for a preview image of the filter. |
| `is_premium` | BOOLEAN | boolean | NOT NULL, DEFAULT `false`, INDEXED | Indicates if this filter requires a premium subscription. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **filters_name_unique** (UNIQUE): `name`
- **idx_filters_deleted_at**: `deleted_at`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Category`

---

### Video

> Represents a user-uploaded video that has been processed with an AI effect. It links the user, the original media, the applied effect, and the resulting processed media.

**Table:** `videos`  
**Scope:** USER_PRIVATE  
**Storage Class:** AI_OUTPUT  
**Lifecycle:** SCHEDULED_EXPIRY  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the video record. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | Foreign key linking to the user who owns the video. |
| `effect_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `effects.id`, NOT NULL, INDEXED | Foreign key linking to the AI effect applied to the video. |
| `original_file_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `files.id`, NOT NULL, INDEXED | Foreign key linking to the original video file uploaded by the user. |
| `processed_file_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `files.id`, INDEXED | Foreign key linking to the processed video file after the AI effect was applied. |
| `title` | STRING | string | - | User-defined title for the video, used in the public gallery. |
| `status` | STRING | string_default(50) | NOT NULL, DEFAULT `pending`, INDEXED | Processing status of the video (e.g., pending, processing, completed, failed). |
| `is_public` | BOOLEAN | boolean | NOT NULL, DEFAULT `false`, INDEXED | Flag indicating if the video is published to the public 'Explore' gallery. |
| `processing_details` | JSON | json | - | Stores metadata about the AI processing job, such as job ID or error messages. |
| `expires_at` | TIMESTAMP | timestamp | INDEXED | Timestamp for when the processed video file will be automatically cleaned up for free-tier users. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **videos_user_id_status_index**: `user_id, status`
- **idx_videos_deleted_at**: `deleted_at`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Effect`
- **belongsTo()**: One-to-One (hasOne/belongsTo) ‚Üí `File`
- **belongsTo()**: One-to-One (hasOne/belongsTo) ‚Üí `File`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Export`

---

### AiModel

> Stores metadata about the underlying AI models used to power the video effects. This is an internal reference and not directly exposed to users.

**Table:** `models`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the AI model. |
| `name` | STRING | string | UNIQUE, NOT NULL | The internal name of the AI model. |
| `description` | TEXT | text | - | A description of the model's capabilities and purpose. |
| `version` | STRING | string(50) | NOT NULL, INDEXED | The version identifier for the model. |
| `provider` | STRING | string(100) | INDEXED | The external service or provider of the AI model (e.g., RunwayML, OpenAI). |
| `external_model_id` | STRING | string | INDEXED | The identifier for the model within the external provider's system. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Indexes

- **models_name_version_unique** (UNIQUE): `name, version`

#### Eloquent Relationships

- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Effect`

---

### Export

> Represents a user's request to download a processed video, capturing the export settings and status. This can be a free (watermarked) or paid (clean) export.

**Table:** `exports`  
**Scope:** USER_PRIVATE  
**Storage Class:** EVENT_LOG  
**Lifecycle:** SCHEDULED_EXPIRY  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the export record. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | Foreign key linking to the user who initiated the export. |
| `video_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `videos.id`, NOT NULL, INDEXED | Foreign key linking to the video being exported. |
| `status` | STRING | string_default(50) | NOT NULL, DEFAULT `pending`, INDEXED | The status of the export job (e.g., pending, processing, completed, failed). |
| `settings` | JSON | json | - | JSON object containing export settings like resolution, format, and quality. |
| `watermark_removed` | BOOLEAN | boolean | NOT NULL, DEFAULT `false` | Flag indicating if this was a premium export with the watermark removed. |
| `exported_file_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `files.id`, INDEXED | Foreign key linking to the final exported file, available for download. |
| `expires_at` | TIMESTAMP | timestamp | INDEXED | Timestamp when the exported file link or record will expire. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Video`
- **belongsTo()**: One-to-One (hasOne/belongsTo) ‚Üí `File`

---

### Style

> Represents a specific visual style or preset that can be applied as part of an effect, such as a color grade, filter, or thematic overlay. Can be free or premium.

**Table:** `styles`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the style. |
| `effect_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `effects.id`, INDEXED | Optional foreign key if this style is specific to one effect. |
| `name` | STRING | string | UNIQUE, NOT NULL | The display name of the style. |
| `description` | TEXT | text | - | A brief description of the style. |
| `thumbnail_url` | STRING | string(2048) | - | URL for a preview thumbnail image of the style. |
| `configuration` | JSON | json | - | JSON object containing the specific parameters and settings for this style. |
| `is_premium` | BOOLEAN | boolean | NOT NULL, DEFAULT `false`, INDEXED | Flag indicating if this style requires a premium subscription to use. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Effect`

---

### Effect

> Defines an AI-powered video effect that users can apply to their videos. This is a central, globally available resource in the application.

**Table:** `effects`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the effect. |
| `name` | STRING | string | UNIQUE, NOT NULL | The public display name of the effect. |
| `slug` | STRING | string | UNIQUE, NOT NULL, INDEXED | A URL-friendly slug for the effect's detail page. |
| `description` | TEXT | text | - | A detailed description of what the effect does and its ideal use cases. |
| `category_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `categories.id`, INDEXED | Foreign key linking to the effect's category for organization. |
| `model_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `models.id`, INDEXED | Foreign key linking to the underlying AI model that powers this effect. |
| `thumbnail_url` | STRING | string(2048) | - | URL for the effect's preview thumbnail image. |
| `preview_video_url` | STRING | string(2048) | - | URL for a short video demonstrating the effect. |
| `is_premium` | BOOLEAN | boolean | NOT NULL, DEFAULT `false`, INDEXED | Flag indicating if this effect requires a premium subscription. |
| `is_active` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | A soft-delete or feature flag to enable/disable the effect for users. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **idx_effects_deleted_at**: `deleted_at`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Category`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `AiModel`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Style`
- **hasMany()**: One-to-Many (hasMany/belongsTo) ‚Üí `Video`

---

### Package

> Represents purchasable items such as subscription plans, credit bundles, or one-time feature unlocks.

**Table:** `packages`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the package. |
| `name` | STRING | string | UNIQUE, NOT NULL, INDEXED | The public display name of the package (e.g., 'Pro Monthly', '10 Export Credits'). |
| `description` | TEXT | text | - | A detailed description of the package's benefits and features. |
| `price` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The price of the package. |
| `currency` | STRING | string(3) | NOT NULL, DEFAULT `USD` | ISO 4217 currency code for the price. |
| `type` | STRING | string(50) | NOT NULL, DEFAULT `ONE_TIME`, INDEXED | Type of package, e.g., 'SUBSCRIPTION', 'CREDIT_PACK', 'ONE_TIME'. |
| `tier_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `tiers.id`, INDEXED | Foreign key to the tiers table, if this package grants a subscription tier. |
| `credits_granted` | INTEGER | integer | NOT NULL, DEFAULT `0` | Number of credits granted upon purchase of this package. |
| `is_active` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | Indicates if the package is currently available for purchase. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **packages_name_unique** (UNIQUE): `name`
- **packages_type_index**: `type`
- **idx_packages_deleted_at**: `deleted_at`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Tier`

---

### Reward

> Stores user rewards or entitlements earned through platform engagement.

**Table:** `rewards`  
**Scope:** USER_PRIVATE  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** SCHEDULED_EXPIRY  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the reward. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | The user who earned this reward. |
| `type` | STRING | string(50) | NOT NULL, DEFAULT `EXPORT_CREDIT`, INDEXED | Type of reward, e.g., 'EXPORT_CREDIT', 'PRO_TRIAL'. |
| `value` | DECIMAL | decimal(10,2) | NOT NULL, DEFAULT `0.0` | The monetary value of the reward if applicable. |
| `description` | STRING | string | NOT NULL | User-facing description of how the reward was earned. |
| `source_action` | STRING | string(100) | INDEXED | The action that triggered the reward, e.g., 'VIDEO_CREATION', 'REFERRAL'. |
| `expires_at` | TIMESTAMP | timestamp | INDEXED | Timestamp for when the reward expires and can no longer be used. |
| `redeemed_at` | TIMESTAMP | timestamp | - | Timestamp for when the reward was redeemed. |
| `purchase_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `purchases.id`, INDEXED | The purchase where this reward was applied. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`
- **belongsTo()**: One-to-One (hasOne/belongsTo) ‚Üí `Purchase`

---

### Tag

> Represents tags that can be applied to various entities, such as videos in the public gallery, for categorization and discovery.

**Table:** `tags`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the tag. |
| `name` | STRING | string | UNIQUE, NOT NULL, INDEXED | The display name of the tag. |
| `slug` | STRING | string | UNIQUE, NOT NULL, INDEXED | A URL-friendly version of the tag name. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |

#### Indexes

- **tags_name_unique** (UNIQUE): `name`
- **tags_slug_unique** (UNIQUE): `slug`

#### Eloquent Relationships

- **morphedByMany()**: Polymorphic (morphTo/morphMany) ‚Üí `Overlay`
- **morphedByMany()**: Polymorphic (morphTo/morphMany) ‚Üí `Watermark`

---

### Subscription

> Manages user subscriptions to various plans, tracking billing cycles and status.

**Table:** `subscriptions`  
**Scope:** USER_PRIVATE  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the subscription. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | The user who owns this subscription. |
| `package_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `packages.id`, NOT NULL, INDEXED | The package this subscription is for. |
| `tier_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `tiers.id`, NOT NULL, INDEXED | The feature tier granted by this subscription. |
| `external_id` | STRING | string | UNIQUE, NOT NULL, INDEXED | The subscription ID from the external payment provider (e.g., Stripe). |
| `status` | STRING | string(50) | NOT NULL, INDEXED | Current status of the subscription (e.g., 'ACTIVE', 'CANCELLED', 'PAUSED', 'TRIALING', 'EXPIRED'). |
| `trial_ends_at` | TIMESTAMP | timestamp | - | Timestamp for when the trial period ends. |
| `period_start` | TIMESTAMP | timestamp | NOT NULL | Start of the current billing period. |
| `period_end` | TIMESTAMP | timestamp | NOT NULL, INDEXED | End of the current billing period. |
| `cancelled_at` | TIMESTAMP | timestamp | - | Timestamp for when the subscription was cancelled by the user. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **subscriptions_user_id_status_index**: `user_id, status`
- **idx_subscriptions_deleted_at**: `deleted_at`

#### Eloquent Relationships

- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Package`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `Tier`

---

### Overlay

> Defines the available animated watermarks and frames that can be applied to videos.

**Table:** `overlays`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the overlay. |
| `name` | STRING | string | UNIQUE, NOT NULL, INDEXED | The public display name of the overlay. |
| `description` | TEXT | text | - | A description of the overlay's appearance or style. |
| `type` | STRING | string(50) | NOT NULL, DEFAULT `WATERMARK`, INDEXED | Type of overlay, e.g., 'WATERMARK', 'FRAME'. |
| `is_premium` | BOOLEAN | boolean | NOT NULL, DEFAULT `false`, INDEXED | Indicates if this overlay requires a premium subscription to use. |
| `is_animated` | BOOLEAN | boolean | NOT NULL, DEFAULT `false` | Indicates if the overlay has animation. |
| `file_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `files.id`, NOT NULL, INDEXED | Reference to the file containing the overlay asset (e.g., SVG, Lottie JSON). |
| `preview_url` | STRING | string(2048) | - | URL to a preview image or GIF of the overlay. |
| `is_active` | BOOLEAN | boolean | NOT NULL, DEFAULT `true`, INDEXED | Indicates if the overlay is currently available for use in the editor. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **overlays_type_is_premium_is_active_index**: `type, is_premium, is_active`
- **idx_overlays_deleted_at**: `deleted_at`

#### Eloquent Relationships

- **belongsTo()**: One-to-One (hasOne/belongsTo) ‚Üí `File`
- **morphToMany()**: Polymorphic (morphTo/morphMany) ‚Üí `Tag`

---

### Watermark

> Represents animated watermarks and frames that can be applied to videos. Includes both free and premium designs, forming a core part of the freemium monetization strategy.

**Table:** `watermarks`  
**Scope:** GLOBAL  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:**   

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the watermark. |
| `name` | STRING | string | UNIQUE, NOT NULL, INDEXED | The unique, user-friendly name of the watermark design (e.g., 'Neon Glow Frame'). |
| `description` | TEXT | text | - | A short description of the watermark's style and intended use. |
| `type` | STRING | string_default(50) | NOT NULL, DEFAULT `FRAME`, INDEXED | The type of watermark, e.g., FRAME, LOGO, BANNER. |
| `is_premium` | BOOLEAN | boolean | NOT NULL, DEFAULT `false`, INDEXED | Flag indicating if this watermark requires a premium subscription to use. |
| `asset_url` | STRING | string(2048) | NOT NULL | URL to the animated asset file (e.g., Lottie JSON, MP4, WebM). |
| `preview_url` | STRING | string(2048) | - | URL to a static or animated preview image/GIF for display in galleries. |
| `customization_options` | JSON | json | - | Defines customizable parameters like default opacity, editable text areas, color palettes, etc. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **watermarks_name_unique** (UNIQUE): `name`
- **watermarks_type_index**: `type`
- **watermarks_is_premium_index**: `is_premium`
- **idx_watermarks_deleted_at**: `deleted_at`

#### Eloquent Relationships

- **morphToMany()**: Polymorphic (morphTo/morphMany) ‚Üí `Tag`

---

### File

> Represents a file stored in cloud storage, such as a user's original uploaded video or a processed video. This table stores metadata and a reference to the file.

**Table:** `files`  
**Scope:** USER_PRIVATE  
**Storage Class:** SOURCE_OF_TRUTH  
**Lifecycle:** PERSISTENT  
**Owner Entity:** User  

#### Fields

| Field | Type | Laravel Type | Constraints | Description |
|-------|------|--------------|-------------|-------------|
| `id` | BIGINT | id | **PK**, UNIQUE, NOT NULL, INDEXED | Primary key for the file record. |
| `user_id` | BIGINT | foreign_id_constrained | **FK** ‚Üí `users.id`, NOT NULL, INDEXED | The user who owns this file. |
| `url` | STRING | string(2048) | NOT NULL | Publicly accessible URL for the file in cloud storage (e.g., S3). |
| `path` | STRING | string(1024) | UNIQUE, NOT NULL, INDEXED | The unique, relative path of the file within its storage disk. |
| `disk` | STRING | string_default(50) | NOT NULL, DEFAULT `s3` | The storage disk where the file is located (e.g., 's3', 'local'). |
| `mime_type` | STRING | string | - | The MIME type of the file (e.g., 'video/mp4'). |
| `size` | BIGINT | unsigned_big_integer | NOT NULL, DEFAULT `0` | File size in bytes. |
| `original_filename` | STRING | string | üîí PII, üîê ENCRYPTED | The original filename as uploaded by the user. Can contain PII. |
| `file_hash` | STRING | string(64) | INDEXED | SHA256 hash of the file content to detect duplicates. |
| `metadata` | JSON | json | - | Stores additional file metadata like video duration, resolution, codec, etc. |
| `created_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `updated_at` | TIMESTAMP | timestamp | NOT NULL | Auto-managed |
| `deleted_at` | TIMESTAMP | timestamp | NULLABLE | Soft delete |

#### Indexes

- **files_path_unique** (UNIQUE): `path`
- **files_file_hash_index**: `file_hash`
- **idx_files_deleted_at**: `deleted_at`

#### Eloquent Relationships

- **hasOne()**: One-to-One (hasOne/belongsTo) ‚Üí `Overlay`
- **belongsTo()**: One-to-Many (hasMany/belongsTo) ‚Üí `User`

---

## Eloquent Relationships

### One-to-Many (hasMany/belongsTo)

- **CreditTransaction**::belongsTo() ‚Üí **User** (through ``)  
  FK: `user_id`

- **User**::hasMany() ‚Üí **CreditTransaction** (through ``)  
  FK: `user_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **GalleryVideo**::belongsTo() ‚Üí **User** (through ``)  
  FK: `user_id`

- **User**::hasMany() ‚Üí **GalleryVideo** (through ``)  
  FK: `user_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Purchase**::belongsTo() ‚Üí **User** (through ``)  
  FK: `user_id`

- **User**::hasMany() ‚Üí **Purchase** (through ``)  
  FK: `user_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Tier**::hasMany() ‚Üí **Subscription** (through ``)  
  FK: `tier_id`

- **Payment**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **Filter**::belongsTo() ‚Üí **Category** (through `null`)  
  FK: `category_id`

- **Video**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **Video**::belongsTo() ‚Üí **Effect** (through `null`)  
  FK: `effect_id`

- **Video**::hasMany() ‚Üí **Export** (through `null`)  
  FK: `video_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **AiModel**::hasMany() ‚Üí **Effect** (through `null`)  
  FK: `model_id`

- **Export**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **Export**::belongsTo() ‚Üí **Video** (through `null`)  
  FK: `video_id`

- **Style**::belongsTo() ‚Üí **Effect** (through `null`)  
  FK: `effect_id`

- **Effect**::belongsTo() ‚Üí **Category** (through `null`)  
  FK: `category_id`

- **Effect**::belongsTo() ‚Üí **AiModel** (through `null`)  
  FK: `model_id`

- **Effect**::hasMany() ‚Üí **Style** (through `null`)  
  FK: `effect_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Effect**::hasMany() ‚Üí **Video** (through `null`)  
  FK: `effect_id`

- **Package**::belongsTo() ‚Üí **Tier** (through `null`)  
  FK: `tier_id`

- **Reward**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **Subscription**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

- **Subscription**::belongsTo() ‚Üí **Package** (through `null`)  
  FK: `package_id`

- **Subscription**::belongsTo() ‚Üí **Tier** (through `null`)  
  FK: `tier_id`

- **File**::belongsTo() ‚Üí **User** (through `null`)  
  FK: `user_id`

### Polymorphic (morphTo/morphMany)

- **Overlay**::morphToMany() ‚Üí **Tag** (through `taggables`)  
  FK: `tag_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Watermark**::morphToMany() ‚Üí **Tag** (through `taggables`)  
  FK: `tag_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Tag**::morphedByMany() ‚Üí **Overlay** (through `taggables`)  
  FK: `taggable_id`

- **Tag**::morphedByMany() ‚Üí **Watermark** (through `taggables`)  
  FK: `taggable_id`

### Many-to-Many (belongsToMany)

- **User**::belongsToMany() ‚Üí **Discount** (through `discount_user`)  
  FK: `discount_id`

- **Discount**::belongsToMany() ‚Üí **User** (through `discount_user`)  
  FK: `user_id`

- **Category**::belongsToMany() ‚Üí **Effect** (through `category_effect`)  
  FK: `effect_id`

- **Algorithm**::belongsToMany() ‚Üí **Effect** (through `algorithm_effect`)  
  FK: `effect_id`

### One-to-One (hasOne/belongsTo)

- **CreditTransaction**::belongsTo() ‚Üí **Purchase** (through ``)  
  FK: `related_purchase_id`

- **Purchase**::hasOne() ‚Üí **CreditTransaction** (through ``)  
  FK: `related_purchase_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Payment**::belongsTo() ‚Üí **Purchase** (through `null`)  
  FK: `purchase_id`

- **Video**::belongsTo() ‚Üí **File** (through `null`)  
  FK: `original_file_id`

- **Video**::belongsTo() ‚Üí **File** (through `null`)  
  FK: `processed_file_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Export**::belongsTo() ‚Üí **File** (through `null`)  
  FK: `exported_file_id`  
  ‚ö†Ô∏è CASCADE DELETE

- **Reward**::belongsTo() ‚Üí **Purchase** (through `null`)  
  FK: `purchase_id`

- **Overlay**::belongsTo() ‚Üí **File** (through `null`)  
  FK: `file_id`

- **File**::hasOne() ‚Üí **Overlay** (through `null`)  
  FK: `file_id`  
  ‚ö†Ô∏è CASCADE DELETE

---

## Indexes Strategy

**Strategy:** IndexStrategy[autoIndexForeignKeys=true, autoIndexTimestamps=false, alwaysIndexFields=[status, type], entityIndexes={}, recommendations=[]]

### Entity Indexes

#### gallery_videos

- `gallery_videos_is_public_created_at_index`: is_public, created_at (BTREE)
- `idx_gallery_videos_deleted_at`: deleted_at (BTREE)
- Field index on `id`
- Field index on `is_public`

#### purchases

- Field index on `id`
- Field index on `status`
- Field index on `external_transaction_id`

#### users

- `users_social_provider_password_hash_or_social_id_index`: social_provider, password_hash_or_social_id (BTREE)
- `idx_users_deleted_at`: deleted_at (BTREE)
- Field index on `id`
- Field index on `email`
- Field index on `social_provider`
- Field index on `authentication_token`

#### discounts

- Field index on `id`
- Field index on `code`
- Field index on `is_active`

#### categories

- `categories_name_unique` **UNIQUE**: name (BTREE)
- `categories_slug_unique` **UNIQUE**: slug (BTREE)
- `idx_categories_deleted_at`: deleted_at (BTREE)
- Field index on `id`
- Field index on `name`
- Field index on `slug`

#### tiers

- `tiers_name_unique` **UNIQUE**: name (BTREE)
- `idx_tiers_deleted_at`: deleted_at (BTREE)
- Field index on `id`
- Field index on `is_active`

#### algorithms

- `algorithms_name_version_unique` **UNIQUE**: name, version (BTREE)
- `idx_algorithms_deleted_at`: deleted_at (BTREE)
- Field index on `id`
- Field index on `version`
- Field index on `provider_name`
- Field index on `is_active`

#### payments

- `payments_transaction_id_unique` **UNIQUE**: transaction_id (BTREE)
- Field index on `id`
- Field index on `transaction_id`
- Field index on `status`
- Field index on `payment_gateway`

#### filters

- `filters_name_unique` **UNIQUE**: name (BTREE)
- `idx_filters_deleted_at`: deleted_at (BTREE)
- Field index on `id`
- Field index on `is_premium`

#### videos

- `videos_user_id_status_index`: user_id, status (BTREE)
- `idx_videos_deleted_at`: deleted_at (BTREE)
- Field index on `id`
- Field index on `status`
- Field index on `is_public`
- Field index on `expires_at`

#### models

- `models_name_version_unique` **UNIQUE**: name, version (BTREE)
- Field index on `id`
- Field index on `version`
- Field index on `provider`
- Field index on `external_model_id`

#### exports

- Field index on `id`
- Field index on `status`
- Field index on `expires_at`

#### styles

- Field index on `id`
- Field index on `is_premium`

#### effects

- `idx_effects_deleted_at`: deleted_at (BTREE)
- Field index on `id`
- Field index on `slug`
- Field index on `is_premium`
- Field index on `is_active`

#### packages

- `packages_name_unique` **UNIQUE**: name (BTREE)
- `packages_type_index`: type (BTREE)
- `idx_packages_deleted_at`: deleted_at (BTREE)
- Field index on `id`
- Field index on `name`
- Field index on `type`
- Field index on `is_active`

#### rewards

- Field index on `id`
- Field index on `type`
- Field index on `source_action`
- Field index on `expires_at`

#### tags

- `tags_name_unique` **UNIQUE**: name (BTREE)
- `tags_slug_unique` **UNIQUE**: slug (BTREE)
- Field index on `id`
- Field index on `name`
- Field index on `slug`

#### subscriptions

- `subscriptions_user_id_status_index`: user_id, status (BTREE)
- `idx_subscriptions_deleted_at`: deleted_at (BTREE)
- Field index on `id`
- Field index on `external_id`
- Field index on `status`
- Field index on `period_end`

#### overlays

- `overlays_type_is_premium_is_active_index`: type, is_premium, is_active (BTREE)
- `idx_overlays_deleted_at`: deleted_at (BTREE)
- Field index on `id`
- Field index on `name`
- Field index on `type`
- Field index on `is_premium`
- Field index on `is_active`

#### watermarks

- `watermarks_name_unique` **UNIQUE**: name (BTREE)
- `watermarks_type_index`: type (BTREE)
- `watermarks_is_premium_index`: is_premium (BTREE)
- `idx_watermarks_deleted_at`: deleted_at (BTREE)
- Field index on `id`
- Field index on `name`
- Field index on `type`
- Field index on `is_premium`

#### files

- `files_path_unique` **UNIQUE**: path (BTREE)
- `files_file_hash_index`: file_hash (BTREE)
- `idx_files_deleted_at`: deleted_at (BTREE)
- Field index on `id`
- Field index on `path`
- Field index on `file_hash`

---

## Schema Remarks

- Schema generated from PCD analysis
- Total entities: 22
- Total relationships: 43
- Coverage mapped: 22 entities
- Foreign key constraints assume the existence of `videos` and `packages` tables, which were not part of this request but are required for the defined relationships to be valid.
- The 'Payment' entity assumes the existence of a 'users' table and a 'purchases' table for foreign key constraints.
- Monetary values are stored using DECIMAL(10, 2) for precision.
- All entities requiring it have soft deletes enabled to preserve data integrity upon deletion.
- The 'Model' entity has been named 'AiModel' with a table name of 'models' to avoid conflicts with the reserved 'Model' keyword in the Laravel framework.
- A separate 'files' table is assumed for storing S3 object metadata, referenced by 'original_file_id', 'processed_file_id', and 'exported_file_id'.
- Many-to-many relationships, such as between effects and tags, would typically be handled by a pivot table (e.g., 'effect_tag'), which is not represented in this schema format.
- The 'Tag' entity requires a corresponding polymorphic pivot table named 'taggables' with 'tag_id', 'taggable_id', and 'taggable_type' columns to link tags to other models like 'gallery_videos'.
- The 'File' entity is a generic record for any stored file. It is expected that other entities, such as 'OriginalVideo' or 'ProcessedVideo', will hold business logic and have a foreign key relationship to a record in the 'files' table.
- The lifecycle of a 'File' record, especially for processed videos, may be managed by a cleanup job (e.g., deleting after 2 days as mentioned in the context), which would be handled at the application layer.
- The many-to-many relationship between User and Discount is inferred from the business logic of users applying discount codes. A pivot table `discount_user` is assumed.
- The many-to-many relationship between Category and Effect is inferred from the context stating 'Effect categories and tags should be a separate entity'. A pivot table `category_effect` is assumed.
- The one-to-many relationship from Tier to Subscription is inferred from the business logic of subscription tiers. A `subscriptions` table with a `tier_id` foreign key is assumed.
- The many-to-many relationship between Algorithm and Effect is inferred, as an effect might use multiple AI algorithms and an algorithm could be used for multiple effects. A pivot table `algorithm_effect` is assumed.
- The relationships from Video and Export to File are modeled as `belongsTo` from the perspective of Video/Export, representing a ONE_TO_ONE cardinality. The specific eloquent method names in the model should be distinct (e.g., originalFile, processedFile, exportedFile).
- Cascade delete is enabled for relationships where the child entity is fully dependent on the parent (e.g., Exports on Video, Styles on Effect). It is disabled for historical records or independent entities to prevent data loss.
- No MANY_TO_MANY or POLYMORPHIC relationships were identified for the focus entities based on the provided schemas.
- The relationship between Tag and other entities like Overlay and Watermark is modeled as a polymorphic many-to-many relationship. The pivot table is assumed to be 'taggables' with 'tag_id', 'taggable_id', and 'taggable_type' columns.
- The File to Overlay relationship is one-to-one. An Overlay is represented by a single File. Deleting the File should cascade and delete the associated Overlay, as the Overlay would be non-functional without its asset.
- For 'belongsTo' relationships, the 'local_key' is interpreted as the key on the target (parent) entity's table, while the 'foreign_key' is on the source (child) entity's table.

## Scalability Analysis

> Auto-generated index recommendations and warnings based on user journey query patterns.

### Auto-Applied Indexes

*No additional indexes recommended based on query patterns.*

### Scalability Warnings (2)

| Type | Table | Journey | Description |
|------|-------|---------|-------------|
| Full Table Scan | `videos` | Freemium Video Effect Application | Query without WHERE clause may cause full table scan |
| Large JSON Read | `videos` | - | SELECT * includes large JSON/TEXT columns - consider selecting specific fields |

#### Warning Details

**FULL_TABLE_SCAN** in *Freemium Video Effect Application*:

```sql
SELECT v.id, v.status, f.url FROM videos AS v JOIN files AS f ON v.processed_file_id = f.id WHERE v.id = ? AND v.user_id = ?;
```

---

## Retrieval Query Examples

> Practical query examples for retrieving data. These can be used by engineering teams and AI tools.

### GalleryVideo

**Basic Retrieval**

```sql
-- Get all GalleryVideos with pagination
SELECT * FROM gallery_videos
  AND deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$galleryVideos = GalleryVideo::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM gallery_videos
WHERE id = :id AND deleted_at IS NULL;
```

```php
$galleryVideo = GalleryVideo::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$galleryVideos = GalleryVideo::query()
    ->with(['belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$galleryVideos = GalleryVideo::query()
    ->where(function ($query) use ($search) {
        $query->where('title', 'like', "%{$search}%");
    })
    ->get();
```

---

### Purchase

**Basic Retrieval**

```sql
-- Get all Purchases with pagination
SELECT * FROM purchases
WHERE user_id = :user_id
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$purchases = Purchase::query()
    ->where('user_id', $userId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM purchases
WHERE id = :id;
```

```php
$purchase = Purchase::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$purchases = Purchase::query()
    ->with(['hasOne', 'belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$purchases = Purchase::query()
    ->where(function ($query) use ($search) {
        $query->where('status', 'like', "%{$search}%")
              ->orWhere('external_transaction_id', 'like', "%{$search}%");
    })
    ->get();
```

---

### User

**Basic Retrieval**

```sql
-- Get all Users with pagination
SELECT * FROM users
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$users = User::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM users
WHERE id = :id AND deleted_at IS NULL;
```

```php
$user = User::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$users = User::query()
    ->with(['hasMany', 'hasMany', 'hasMany', 'belongsToMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$users = User::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('email', 'like', "%{$search}%")
              ->orWhere('password_hash_or_social_id', 'like', "%{$search}%");
    })
    ->get();
```

---

### Discount

**Basic Retrieval**

```sql
-- Get all Discounts with pagination
SELECT * FROM discounts
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$discounts = Discount::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM discounts
WHERE id = :id;
```

```php
$discount = Discount::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$discounts = Discount::query()
    ->with(['belongsToMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$discounts = Discount::query()
    ->where(function ($query) use ($search) {
        $query->where('code', 'like', "%{$search}%");
    })
    ->get();
```

---

### Category

**Basic Retrieval**

```sql
-- Get all Categorys with pagination
SELECT * FROM categories
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$categorys = Category::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM categories
WHERE id = :id AND deleted_at IS NULL;
```

```php
$category = Category::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$categorys = Category::query()
    ->with(['belongsToMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$categorys = Category::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('slug', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%");
    })
    ->get();
```

---

### Tier

**Basic Retrieval**

```sql
-- Get all Tiers with pagination
SELECT * FROM tiers
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$tiers = Tier::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM tiers
WHERE id = :id AND deleted_at IS NULL;
```

```php
$tier = Tier::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$tiers = Tier::query()
    ->with(['hasMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$tiers = Tier::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%");
    })
    ->get();
```

---

### Algorithm

**Basic Retrieval**

```sql
-- Get all Algorithms with pagination
SELECT * FROM algorithms
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$algorithms = Algorithm::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM algorithms
WHERE id = :id AND deleted_at IS NULL;
```

```php
$algorithm = Algorithm::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$algorithms = Algorithm::query()
    ->with(['belongsToMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$algorithms = Algorithm::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('version', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%");
    })
    ->get();
```

---

### Payment

**Basic Retrieval**

```sql
-- Get all Payments with pagination
SELECT * FROM payments
WHERE tenant_id = :tenant_id
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$payments = Payment::query()
    ->where('tenant_id', $tenantId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM payments
WHERE id = :id;
```

```php
$payment = Payment::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$payments = Payment::query()
    ->with(['belongsTo', 'belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$payments = Payment::query()
    ->where(function ($query) use ($search) {
        $query->where('transaction_id', 'like', "%{$search}%")
              ->orWhere('status', 'like', "%{$search}%")
              ->orWhere('currency', 'like', "%{$search}%");
    })
    ->get();
```

---

### Filter

**Basic Retrieval**

```sql
-- Get all Filters with pagination
SELECT * FROM filters
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$filters = Filter::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM filters
WHERE id = :id AND deleted_at IS NULL;
```

```php
$filter = Filter::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$filters = Filter::query()
    ->with(['belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$filters = Filter::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('thumbnail_url', 'like', "%{$search}%");
    })
    ->get();
```

---

### Video

**Basic Retrieval**

```sql
-- Get all Videos with pagination
SELECT * FROM videos
WHERE user_id = :user_id
  AND deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$videos = Video::query()
    ->where('user_id', $userId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM videos
WHERE id = :id AND deleted_at IS NULL;
```

```php
$video = Video::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$videos = Video::query()
    ->with(['belongsTo', 'belongsTo', 'belongsTo', 'belongsTo', 'hasMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$videos = Video::query()
    ->where(function ($query) use ($search) {
        $query->where('title', 'like', "%{$search}%")
              ->orWhere('status', 'like', "%{$search}%");
    })
    ->get();
```

---

### AiModel

**Basic Retrieval**

```sql
-- Get all AiModels with pagination
SELECT * FROM models
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$aiModels = AiModel::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM models
WHERE id = :id;
```

```php
$aiModel = AiModel::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$aiModels = AiModel::query()
    ->with(['hasMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$aiModels = AiModel::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('version', 'like', "%{$search}%");
    })
    ->get();
```

---

### Export

**Basic Retrieval**

```sql
-- Get all Exports with pagination
SELECT * FROM exports
WHERE user_id = :user_id
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$exports = Export::query()
    ->where('user_id', $userId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM exports
WHERE id = :id;
```

```php
$export = Export::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$exports = Export::query()
    ->with(['belongsTo', 'belongsTo', 'belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$exports = Export::query()
    ->where(function ($query) use ($search) {
        $query->where('status', 'like', "%{$search}%");
    })
    ->get();
```

---

### Style

**Basic Retrieval**

```sql
-- Get all Styles with pagination
SELECT * FROM styles
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$styles = Style::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM styles
WHERE id = :id;
```

```php
$style = Style::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$styles = Style::query()
    ->with(['belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$styles = Style::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('thumbnail_url', 'like', "%{$search}%");
    })
    ->get();
```

---

### Effect

**Basic Retrieval**

```sql
-- Get all Effects with pagination
SELECT * FROM effects
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$effects = Effect::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM effects
WHERE id = :id AND deleted_at IS NULL;
```

```php
$effect = Effect::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$effects = Effect::query()
    ->with(['belongsTo', 'belongsTo', 'hasMany', 'hasMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$effects = Effect::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('slug', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%");
    })
    ->get();
```

---

### Package

**Basic Retrieval**

```sql
-- Get all Packages with pagination
SELECT * FROM packages
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$packages = Package::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM packages
WHERE id = :id AND deleted_at IS NULL;
```

```php
$package = Package::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$packages = Package::query()
    ->with(['belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$packages = Package::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('currency', 'like', "%{$search}%");
    })
    ->get();
```

---

### Reward

**Basic Retrieval**

```sql
-- Get all Rewards with pagination
SELECT * FROM rewards
WHERE user_id = :user_id
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$rewards = Reward::query()
    ->where('user_id', $userId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM rewards
WHERE id = :id;
```

```php
$reward = Reward::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$rewards = Reward::query()
    ->with(['belongsTo', 'belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$rewards = Reward::query()
    ->where(function ($query) use ($search) {
        $query->where('type', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('source_action', 'like', "%{$search}%");
    })
    ->get();
```

---

### Tag

**Basic Retrieval**

```sql
-- Get all Tags with pagination
SELECT * FROM tags
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$tags = Tag::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM tags
WHERE id = :id;
```

```php
$tag = Tag::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$tags = Tag::query()
    ->with(['morphedByMany', 'morphedByMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$tags = Tag::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('slug', 'like', "%{$search}%");
    })
    ->get();
```

---

### Subscription

**Basic Retrieval**

```sql
-- Get all Subscriptions with pagination
SELECT * FROM subscriptions
WHERE user_id = :user_id
  AND deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$subscriptions = Subscription::query()
    ->where('user_id', $userId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM subscriptions
WHERE id = :id AND deleted_at IS NULL;
```

```php
$subscription = Subscription::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$subscriptions = Subscription::query()
    ->with(['belongsTo', 'belongsTo', 'belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$subscriptions = Subscription::query()
    ->where(function ($query) use ($search) {
        $query->where('external_id', 'like', "%{$search}%")
              ->orWhere('status', 'like', "%{$search}%");
    })
    ->get();
```

---

### Overlay

**Basic Retrieval**

```sql
-- Get all Overlays with pagination
SELECT * FROM overlays
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$overlays = Overlay::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM overlays
WHERE id = :id AND deleted_at IS NULL;
```

```php
$overlay = Overlay::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$overlays = Overlay::query()
    ->with(['belongsTo', 'morphToMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$overlays = Overlay::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('type', 'like', "%{$search}%");
    })
    ->get();
```

---

### Watermark

**Basic Retrieval**

```sql
-- Get all Watermarks with pagination
SELECT * FROM watermarks
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$watermarks = Watermark::query()
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM watermarks
WHERE id = :id AND deleted_at IS NULL;
```

```php
$watermark = Watermark::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$watermarks = Watermark::query()
    ->with(['morphToMany'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$watermarks = Watermark::query()
    ->where(function ($query) use ($search) {
        $query->where('name', 'like', "%{$search}%")
              ->orWhere('description', 'like', "%{$search}%")
              ->orWhere('type', 'like', "%{$search}%");
    })
    ->get();
```

---

### File

**Basic Retrieval**

```sql
-- Get all Files with pagination
SELECT * FROM files
WHERE user_id = :user_id
  AND deleted_at IS NULL
ORDER BY created_at DESC
LIMIT 20 OFFSET 0;
```

```php
// Laravel Eloquent
$files = File::query()
    ->where('user_id', $userId)
    ->orderBy('created_at', 'desc')
    ->paginate(20);
```

**Find by ID**

```sql
SELECT * FROM files
WHERE id = :id AND deleted_at IS NULL;
```

```php
$file = File::findOrFail($id);
```

**With Relationships**

```php
// Eager load relationships
$files = File::query()
    ->with(['hasOne', 'belongsTo'])
    ->get();
```

**Search Query**

```php
// Search across text fields
$files = File::query()
    ->where(function ($query) use ($search) {
        $query->where('url', 'like', "%{$search}%")
              ->orWhere('path', 'like', "%{$search}%")
              ->orWhere('disk', 'like', "%{$search}%");
    })
    ->get();
```

---

