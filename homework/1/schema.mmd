erDiagram
  CREDIT_TRANSACTIONS {
    bigint id PK "Primary key for the credit transaction."
    bigint user_id FK "The user who this transaction belongs to."
    string type "Type of transaction (e.g., EARNED_PROCESSING, SPENT_PURCHASE, PURCHASED_PACK, ADMIN_ADJUSTMENT)."
    decimal amount "The amount of credits transacted. Can be positive (earned) or negative (spent)."
    text description "A human-readable description of the transaction."
    bigint related_id "Polymorphic relation ID to the source of the transaction (e.g., Video, Purchase)."
    string related_type "Polymorphic relation type to the source of the transaction (e.g., App\Models\Video, App\Models\Purchase)."
    timestamp created_at
    timestamp updated_at
  }

  PURCHASES {
    bigint id PK "Primary key for the purchase."
    bigint user_id FK "The user who made the purchase."
    bigint purchasable_id "Polymorphic relation ID for the item being purchased (e.g., Package, Subscription)."
    string purchasable_type "Polymorphic relation type for the item being purchased (e.g., App\Models\Package)."
    bigint discount_id FK "The discount applied to this purchase, if any."
    decimal total_amount "The final amount paid after any discounts."
    string currency "The currency of the transaction (e.g., USD)."
    string status "The status of the purchase (e.g., PENDING, COMPLETED, FAILED, REFUNDED)."
    timestamp processed_at "Timestamp when the payment was successfully processed."
    string provider_transaction_id "The transaction ID from the external payment provider (e.g., Stripe)."
    timestamp created_at
    timestamp updated_at
  }

  USERS {
    bigint id PK "Primary key for the user."
    string name "User's full name."
    string email UK "User's unique email address, used for login and communication."
    timestamp email_verified_at UK "Timestamp when the user verified their email address."
    string password "User's hashed password."
    string remember_token "Token for the 'remember me' functionality."
    decimal credit_balance "Current balance of loyalty/discount credits."
    bigint subscription_id FK "The user's active subscription, if any."
    timestamp created_at
    timestamp updated_at
    timestamp deleted_at
  }

  DISCOUNTS {
    bigint id PK "Primary key for the discount."
    string code UK "The unique code for the discount that users can enter."
    text description "A description of the discount for internal reference."
    string type "The type of discount (e.g., PERCENTAGE, FIXED_AMOUNT)."
    decimal value "The value of the discount (e.g., 10.00 for 10% or $10.00)."
    int max_uses "The maximum number of times this discount can be used in total. Null for unlimited."
    int uses "The number of times this discount has been used."
    timestamp starts_at "The timestamp when the discount becomes active."
    timestamp expires_at "The timestamp when the discount expires."
    boolean is_active "Whether the discount is currently active."
    timestamp created_at
    timestamp updated_at
  }

  CATEGORIES {
    bigint id PK "Primary key for the category."
    bigint parent_id FK "The parent category for creating hierarchical structures."
    string name "The display name of the category."
    string slug UK "A URL-friendly version of the category name."
    text description "A description of the category's content."
    boolean is_visible "Controls whether the category is visible to users."
    timestamp created_at
    timestamp updated_at
  }

  BACKGROUNDS {
    bigint id PK "Primary key for the background."
    string name UK "The display name of the background."
    text image_url "URL to the background image file, likely stored in cloud storage (e.g., S3)."
    boolean is_default "Indicates if this is a default background option available to all users."
    timestamp created_at
    timestamp updated_at
  }

  TIERS {
    bigint id PK "Primary key for the tier."
    string name UK "The unique name of the subscription tier (e.g., 'Free', 'Pro')."
    text description "A brief description of the tier's benefits."
    decimal price_monthly "The monthly price for this tier."
    decimal price_yearly "The yearly price for this tier."
    json features "A JSON array of features included in this tier."
    boolean is_active "A flag to enable or disable the tier from being offered to new users."
    timestamp created_at
    timestamp updated_at
    timestamp deleted_at
  }

  MILESTONES {
    bigint id PK "Primary key for the milestone."
    bigint user_id FK "The user who achieved this milestone."
    string name "The name of the milestone (e.g., 'First Video Processed')."
    text description "A description of what the milestone entails."
    int target_count "The target number of actions required to achieve the milestone."
    timestamp achieved_at "Timestamp when the user achieved this milestone."
    bigint reward_id FK "The reward (e.g., discount) granted for achieving this milestone."
    timestamp created_at
    timestamp updated_at
  }

  GALLERY_ITEMS {
    bigint id PK "Primary key for the gallery item."
    bigint user_id FK "The user who created and published this item."
    bigint video_id FK "The processed video being shared in the gallery."
    bigint effect_id FK "The AI effect used in the video, for filtering and discovery."
    string title "User-provided title for the gallery item."
    text description "User-provided description for the gallery item."
    boolean is_public "Controls the visibility of the item in the public gallery."
    bigint view_count "A counter for the number of times the gallery item has been viewed."
    timestamp created_at
    timestamp updated_at
    timestamp deleted_at
  }

  PAYMENTS {
    bigint id PK "Primary key for the payment."
    bigint user_id FK "The user who made the payment."
    bigint purchase_id FK "The purchase record this payment is associated with."
    decimal amount "The monetary amount of the transaction."
    string currency "The ISO 4217 currency code (e.g., USD)."
    string status "The status of the payment (e.g., pending, completed, failed, refunded)."
    string provider "The payment provider used for the transaction (e.g., 'stripe', 'paddle')."
    string provider_transaction_id UK "The unique transaction identifier from the payment provider."
    timestamp processed_at "Timestamp indicating when the payment was successfully processed."
    json metadata "Stores any additional metadata from the payment provider."
    timestamp created_at
    timestamp updated_at
  }

  FILTERS {
    bigint id PK "Primary key for the filter."
    bigint category_id FK "Foreign key linking to the effect category for organization."
    string name UK "The public-facing name of the filter/effect (e.g., 'Snowfall Overlay')."
    text description "A user-friendly description of what the effect does and its suggested use case."
    json settings_json "Stores configuration parameters for the AI model, such as default intensity, color palettes, or other customizable options."
    string preview_video_url "URL to a sample video that demonstrates the effect in action."
    boolean is_premium "Flag indicating if this effect requires a premium subscription to use."
    boolean is_active "A soft-toggle to enable or disable the filter's availability to users without deleting it."
    timestamp created_at
    timestamp updated_at
    timestamp deleted_at
  }

  VIDEOS {
    bigint id PK "Primary key for the video record."
    bigint user_id FK "Foreign key linking to the user who uploaded the video."
    uuid uuid UK "A public-facing, unique identifier for the video, used in URLs and APIs."
    string original_filename "The original filename of the video as uploaded by the user."
    string storage_path "The path to the video file in the cloud storage provider (e.g., S3 bucket path)."
    string mime_type "The MIME type of the uploaded video file (e.g., 'video/mp4')."
    bigint file_size "The size of the video file in bytes."
    decimal duration "The duration of the video in seconds."
    int width "The width of the video in pixels."
    int height "The height of the video in pixels."
    string status "The current status of the video upload and initial processing (e.g., PENDING, UPLOADED, VALIDATED, FAILED)."
    timestamp created_at
    timestamp updated_at
    timestamp deleted_at
  }

  MODELS {
    bigint id PK "Primary key for the AI model."
    bigint filter_id FK "Foreign key linking the model to a specific filter it powers."
    string name "Internal name for the AI model."
    string version "Version of the model, e.g., 'v1.2.0'."
    text description "Internal description of the model's capabilities and architecture."
    string endpoint_url "The API endpoint URL if the model is hosted as an external microservice."
    boolean is_active "A soft-toggle to enable or disable the model for processing jobs."
    timestamp created_at
    timestamp updated_at
    timestamp deleted_at
  }

  EXPORTS {
    bigint id PK "Primary key for the export record."
    bigint user_id FK "Foreign key linking to the user who initiated the export."
    bigint video_id FK "Foreign key linking to the original source video."
    bigint filter_id FK "Foreign key linking to the filter/effect that was applied."
    bigint watermark_id FK "Foreign key linking to the specific watermark design used, if any."
    uuid uuid UK "A public-facing, unique identifier for the exported video, used for sharing links."
    string status "The current status of the export job (e.g., PENDING, PROCESSING, COMPLETED, FAILED)."
    string storage_path "The path to the final processed video file in cloud storage."
    bigint file_size "The size of the exported video file in bytes."
    boolean with_watermark "Indicates whether the exported video includes a watermark."
    boolean is_public "Flag indicating if the user has published this video to the public 'Explore' gallery."
    string public_title "The user-provided title for the video when published to the public gallery."
    json public_tags "User-provided tags for discoverability in the public gallery."
    timestamp expires_at "Timestamp for when the exported video file should be automatically cleaned up, especially for free-tier users."
    timestamp created_at
    timestamp updated_at
    timestamp deleted_at
  }

  STYLES {
    bigint id PK "Primary key for the style."
    string name UK "The public-facing name of the style (e.g., 'Neon Glow Frame')."
    text description "A brief description of the style's appearance or animation."
    string type "The type of style, used for categorization (e.g., WATERMARK, FRAME, OVERLAY)."
    json css_properties_json "Stores CSS or animation properties (e.g., for Lottie) to render the style on the front-end."
    string preview_image_url "URL to a preview image or GIF that demonstrates the style."
    boolean is_premium "Flag indicating if this style is a premium-only option."
    boolean is_active "A soft-toggle to enable or disable the style's availability to users."
    timestamp created_at
    timestamp updated_at
    timestamp deleted_at
  }

  EFFECTS {
    bigint id PK "Primary key for the effect."
    string name "The user-facing name of the effect (e.g., 'Snowfall Overlay')."
    string slug UK "A URL-friendly version of the effect name for use in routes."
    text description "A detailed description of what the effect does and its best use cases."
    bigint category_id FK "Foreign key linking to the categories table to group effects."
    string preview_video_url "URL to a sample video file showcasing the effect in action."
    boolean is_premium "Flag indicating if this effect requires a premium subscription to use."
    boolean is_active "Toggles the visibility and availability of the effect in the application."
    json parameters_schema "JSON schema defining user-configurable parameters for the effect, like intensity or color."
    timestamp created_at
    timestamp updated_at
    timestamp deleted_at
  }

  PACKAGES {
    bigint id PK "Primary key for the package."
    string name "The user-facing name of the package (e.g., 'Pro Monthly', '5 Export Credits')."
    string slug UK "A unique, URL-friendly identifier for the package."
    text description "A description of the package's benefits and features."
    string type "The type of package, e.g., 'subscription', 'credit_pack', 'one_time'."
    decimal price "The price of the package in the specified currency."
    string currency "The ISO 4217 currency code for the price."
    int credits_granted "Number of credits this package provides, if applicable."
    boolean is_active "Toggles whether this package is currently available for purchase."
    string stripe_price_id "The corresponding price ID from the Stripe payment provider."
    timestamp created_at
    timestamp updated_at
    timestamp deleted_at
  }

  REWARDS {
    bigint id PK "Primary key for the reward."
    bigint user_id FK "The user who received this reward."
    bigint milestone_id FK "The milestone that triggered this reward, if any."
    string name "The user-facing name of the reward (e.g., '20% Off Coupon')."
    text description "A description of what the reward is."
    string type "The type of reward, e.g., 'discount_coupon', 'free_export', 'credit_bonus'."
    json value "JSON object storing the reward's value, e.g., {'percentage': 20} or {'credits': 100}."
    timestamp unlocked_at "Timestamp of when the user earned the reward."
    timestamp claimed_at "Timestamp of when the user used or claimed the reward."
    timestamp expires_at "Timestamp indicating when the reward expires, if applicable."
    timestamp created_at
    timestamp updated_at
  }

  TAGS {
    bigint id PK "Primary key for the tag."
    string name UK "The display name of the tag."
    string slug UK "A URL-friendly, unique version of the tag name."
    timestamp created_at
    timestamp updated_at
    timestamp deleted_at
  }

  SUBSCRIPTIONS {
    bigint id PK "Primary key for the subscription."
    bigint user_id FK "The user who owns this subscription."
    bigint package_id FK "The subscription plan/package the user is subscribed to."
    string stripe_subscription_id UK "The unique subscription identifier from the Stripe payment provider."
    string status "The current status of the subscription (e.g., 'active', 'cancelled', 'trialing', 'past_due')."
    timestamp trial_ends_at "The date and time when the trial period ends, if applicable."
    timestamp period_start "The start date and time of the current billing period."
    timestamp period_end "The end date and time of the current billing period."
    timestamp cancelled_at "The date and time when the subscription was cancelled by the user."
    timestamp ends_at "The date and time when the subscription will fully expire and access will be revoked."
    timestamp created_at
    timestamp updated_at
    timestamp deleted_at
  }

  OVERLAYS {
    bigint id PK "Primary key for the overlay."
    string name UK "The unique name of the overlay, e.g., 'Snowfall Overlay'."
    text description "A brief description of the overlay's visual effect."
    string preview_url "URL to a preview image or short video of the overlay."
    string asset_url "URL to the actual overlay asset file stored in cloud storage (e.g., S3)."
    string type "Categorization of the overlay, e.g., 'weather', 'frame', 'style'."
    boolean is_premium "Flag indicating if this overlay requires a premium subscription."
    json default_settings "Default parameters for the overlay, such as opacity, position, or intensity."
    timestamp created_at
    timestamp updated_at
  }

  WATERMARKS {
    bigint id PK "Primary key for the watermark design."
    string name UK "The unique name of the watermark design, e.g., 'Classic Lower-Third'."
    text description "A brief description of the watermark's style and appearance."
    string preview_url "URL to a preview image or short video of the watermark."
    string asset_url "URL to the actual watermark asset file (e.g., an animated overlay) stored in cloud storage."
    boolean is_premium "Flag indicating if this watermark design requires a premium subscription."
    boolean is_animated "Flag indicating if the watermark has animation."
    json default_settings "Default parameters for the watermark, such as opacity, position, and default text content."
    timestamp created_at
    timestamp updated_at
  }

  USERS ||--o{ CREDIT_TRANSACTIONS : "hasMany"
  CREDIT_TRANSACTIONS ||--o{ USERS : "belongsTo"
  USERS ||--o{ PURCHASES : "hasMany"
  PURCHASES ||--o{ USERS : "belongsTo"
  TIERS ||--o{ PURCHASES : "morphMany"
  DISCOUNTS ||--o{ PURCHASES : "hasMany"
  PURCHASES ||--o{ DISCOUNTS : "belongsTo"
  USERS ||--o{ MILESTONES : "hasMany"
  MILESTONES ||--o{ USERS : "belongsTo"
  CATEGORIES ||--o{ CATEGORIES : "belongsTo"
  CATEGORIES ||--o{ CATEGORIES : "hasMany"
  GALLERY_ITEMS ||--o{ USERS : "belongsTo"
  GALLERY_ITEMS ||--o{ VIDEOS : "belongsTo"
  GALLERY_ITEMS ||--o{ EFFECTS : "belongsTo"
  PAYMENTS ||--o{ USERS : "belongsTo"
  PAYMENTS ||--o{ PURCHASES : "belongsTo"
  FILTERS ||--o{ CATEGORIES : "belongsTo"
  FILTERS ||--o{ MODELS : "hasMany"
  FILTERS ||--o{ EXPORTS : "hasMany"
  VIDEOS ||--o{ USERS : "belongsTo"
  VIDEOS ||--o{ GALLERY_ITEMS : "hasMany"
  VIDEOS ||--o{ EXPORTS : "hasMany"
  MODELS ||--o{ FILTERS : "belongsTo"
  EXPORTS ||--o{ USERS : "belongsTo"
  EXPORTS ||--o{ VIDEOS : "belongsTo"
  EXPORTS ||--o{ FILTERS : "belongsTo"
  EXPORTS ||--o{ WATERMARKS : "belongsTo"
  EFFECTS ||--o{ CATEGORIES : "belongsTo"
  EFFECTS ||--o{ GALLERY_ITEMS : "hasMany"
  PACKAGES ||--o{ SUBSCRIPTIONS : "hasMany"
  SUBSCRIPTIONS ||--o{ PACKAGES : "belongsTo"
  SUBSCRIPTIONS ||--o{ USERS : "belongsTo"
  USERS ||--o{ SUBSCRIPTIONS : "hasMany"
  REWARDS ||--o{ USERS : "belongsTo"
  USERS ||--o{ REWARDS : "hasMany"
  REWARDS ||--o{ MILESTONES : "belongsTo"
  MILESTONES ||--o{ REWARDS : "hasMany"
  TAGS ||--o{ EFFECTS : "morphedByMany"
  EFFECTS ||--o{ TAGS : "morphToMany"
  PACKAGES }o--o{ WATERMARKS : "belongsToMany"
  WATERMARKS }o--o{ PACKAGES : "belongsToMany"
  PACKAGES }o--o{ OVERLAYS : "belongsToMany"
  OVERLAYS }o--o{ PACKAGES : "belongsToMany"
  WATERMARKS ||--o{ VIDEOS : "hasMany"
  VIDEOS ||--o{ WATERMARKS : "belongsTo"
  OVERLAYS }o--o{ VIDEOS : "belongsToMany"
  VIDEOS }o--o{ OVERLAYS : "belongsToMany"
